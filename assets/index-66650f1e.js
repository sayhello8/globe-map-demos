import{g as J,F as Z,C as G,i as K,G as w,h as ee,j as S,w as te,x as ae,y as ne,z,L as $,o as b,V as m,E,a4 as ie,D as _,M as x,H as se,b as M,P as C,S as B,A as P,N as oe,I as re,Q as le,T as ce,q as pe,m as O,n as N,_ as Q,u as R,v as W,J as ue,K as he,O as de,U as fe,W as me,X as ge,Y as ve}from"./szxs_logo-0ab5ca1e.js";import{B as U,L as D,E as ye,G as be,a as xe,l as A,P as q,b as k,g as we,_ as Le,c as Me,h as Pe,r as Se,d as Ge,f as V,e as Ce,i as _e,o as Be,s as Ie,m as Te,j as je,p as Ae}from"./flyLine2-932ac3c5.js";import{o as I,c as T,a as L,F as Fe,r as ze,n as $e,t as Y,b as Ee,d as Oe,e as Ne}from"./index-63eb6f16.js";const Re=[{name:"北京市",center:[116.405285,39.904989],centroid:[116.41995,40.18994],hide:!0},{name:"天津市",center:[117.190182,39.125596],centroid:[117.347043,39.288036],hide:!0},{name:"河北省",center:[114.502461,38.045474],centroid:[114.502461,38.045474],hide:!0},{name:"山西省",center:[112.549248,37.857014],centroid:[112.304436,37.618179],hide:!0},{name:"内蒙古自治区",center:[111.670801,40.818311],centroid:[114.077429,44.331087],hide:!0},{name:"辽宁省",center:[123.429096,41.796767],centroid:[122.604994,41.299712],hide:!0},{name:"吉林省",center:[125.3245,43.886841],centroid:[126.171208,43.703954],hide:!0},{name:"黑龙江省",center:[126.642464,45.756967],centroid:[127.693027,48.040465],hide:!0},{name:"上海市",center:[121.472644,31.231706],centroid:[121.438737,31.072559],hide:!0},{name:"江苏省",center:[118.767413,32.041544],centroid:[119.486506,32.983991],hide:!1},{name:"浙江省",center:[120.153576,30.287459],centroid:[120.109913,29.181466],hide:!0},{name:"安徽省",center:[117.283042,31.86119],centroid:[117.226884,31.849254],hide:!1},{name:"福建省",center:[119.306239,26.075302],centroid:[118.006468,26.069925],hide:!1},{name:"江西省",center:[115.892151,28.676493],centroid:[115.732975,27.636112],hide:!1},{name:"山东省",center:[117.000923,36.675807],centroid:[118.187759,36.376092],blur:!0},{name:"河南省",center:[113.665412,34.757975],centroid:[113.619717,33.902648],blur:!0},{name:"湖北省",center:[114.298572,30.584355],centroid:[112.271301,30.987527],blur:!0},{name:"湖南省",center:[112.982279,28.19409],centroid:[111.711649,27.629216],blur:!0},{name:"广东省",center:[113.280637,23.125178],centroid:[113.429919,23.334643],blur:!0},{name:"广西壮族自治区",center:[108.320004,22.82402],centroid:[108.7944,23.833381],hide:!0},{name:"海南省",center:[110.33119,20.031971],centroid:[109.754859,19.189767],hide:!0},{name:"重庆市",center:[106.504962,29.533155],centroid:[107.8839,30.067297],blur:!0},{name:"四川省",center:[104.065735,30.659462],centroid:[102.693453,30.674545],hide:!0},{name:"贵州省",center:[106.713478,26.578343],centroid:[106.880455,26.826368],blur:!0},{name:"云南省",center:[102.712251,25.040609],centroid:[101.485106,25.008643],hide:!0},{name:"西藏自治区",center:[91.132212,29.660361],centroid:[88.388277,31.56375],hide:!0},{name:"陕西省",center:[108.948024,34.263161],centroid:[108.887114,35.263661],hide:!0},{name:"甘肃省",center:[103.823557,36.058039],centroid:[103.823557,36.058039],hide:!0},{name:"青海省",center:[101.778916,36.623178],centroid:[96.043533,35.726403],hide:!0},{name:"宁夏回族自治区",center:[106.278179,38.46637],centroid:[106.169866,37.291332],hide:!0},{name:"新疆维吾尔自治区",center:[87.617733,43.792818],centroid:[85.294711,41.371801],hide:!0},{name:"台湾省",center:[121.509062,25.044332],centroid:[120.971485,23.749452]},{name:"香港特别行政区",center:[114.173355,22.320048],centroid:[114.134357,22.377366],hide:!0},{name:"澳门特别行政区",center:[113.54909,22.198951],centroid:[113.566988,22.159307],hide:!0}],X=[{name:"杭州市",enName:"hangzhou",value:98,center:[120.153576,30.287459],centroid:[119.476498,29.898918]},{name:"宁波市",enName:"ningbo",value:57,center:[121.549792,29.868388],centroid:[121.479174,29.733017]},{name:"温州市",enName:"wenzhou",value:80,center:[120.672111,28.000575],centroid:[120.463912,27.894726]},{name:"嘉兴市",enName:"jiaxing",value:42,center:[120.750865,30.762653],centroid:[120.783487,30.620063]},{name:"湖州市",enName:"huzhou",value:37,center:[120.102398,30.867198],centroid:[119.873663,30.743058]},{name:"绍兴市",enName:"shaoxing",value:24,center:[120.582112,29.997117],centroid:[120.640933,29.732893]},{name:"金华市",enName:"jinghua",value:43,center:[119.649506,29.089524],centroid:[119.957007,29.115117]},{name:"衢州市",enName:"hengzhou",value:46,center:[118.87263,28.941708],centroid:[118.679569,28.932446]},{name:"舟山市",enName:"zhousan",value:37,center:[122.106863,30.016028],centroid:[122.146805,30.056563]},{name:"台州市",enName:"taizhou",value:36,center:[121.428599,28.661378],centroid:[121.136679,28.757098]},{name:"丽水市",enName:"lishui",value:48,center:[119.921786,28.451993],centroid:[119.517145,28.197644]}],Ue=[{value:166,lng:119.00838863314104,lat:29.70446787438727},{value:196,lng:121.95888480416225,lat:29.804570962222094},{value:145,lng:121.1763690119717,lat:29.943827249850777},{value:101,lng:121.56920938135673,lat:29.85263574108389},{value:199,lng:120.9772766279951,lat:28.330342193214033},{value:167,lng:120.33101898043361,lat:30.565600410098323},{value:169,lng:120.36095289685078,lat:30.739761809104824},{value:101,lng:119.983185482632,lat:31.03706617454779},{value:121,lng:121.20282810334723,lat:29.45300711212515},{value:132,lng:120.04632515461387,lat:29.535586166289217},{value:132,lng:119.88396764642604,lat:29.24289373808931},{value:119,lng:118.20295164180662,lat:28.97847155167772},{value:138,lng:119.30239039019484,lat:28.963362607831762},{value:183,lng:122.11925213943688,lat:30.09279983271788},{value:103,lng:122.0641872449813,lat:30.624331727210976},{value:110,lng:121.24428726916929,lat:28.29819603626963},{value:171,lng:120.83475957600818,lat:29.104535097251688},{value:174,lng:119.70182146944745,lat:28.267110085326326}],De=[{name:"监测点#01",level:"差",value:84.9,lng:118.27595005,lat:29.11596322},{name:"监测点#02",level:"极好",value:12.5,lng:118.94093792,lat:27.90619049},{name:"监测点#03",level:"良好",value:52.8,lng:121.35456753,lat:28.34783376},{name:"监测点#04",level:"好",value:32,lng:122.10985921,lat:30.05331943}];function F(h){return h.sort((e,t)=>t.value-e.value),h}class qe extends J{constructor(e,t){super(e),this.geoProjectionCenter=[120.109913,29.181466],this.geoProjectionScale=130,this.flyLineCenter=[119.476498,29.898918],this.depth=.5,this.mapFocusLabelInfo={name:"浙江省",enName:"ZHEJIANG PROVINCE",center:[120.109913,26.881466]},this.clicked=!1,this.scene.fog=new Z(0,1,50),this.scene.background=new G(0),this.camera.instance.position.set(-13.767695123014105,12.990152163077308,39.28228164159694),this.camera.instance.near=1,this.camera.instance.far=1e4,this.camera.instance.updateProjectionMatrix(),this.interactionManager=new K(this.renderer.instance,this.camera.instance,this.canvas),this.playing=!1,this.assets=t,this.initEnvironment(),this.init()}init(){this.labelGroup=new w,this.label3d=new ee(this),this.labelGroup.rotation.x=-Math.PI/2,this.scene.add(this.labelGroup),this.flyLineFocusGroup=new w,this.flyLineFocusGroup.visible=!1,this.flyLineFocusGroup.rotation.x=-Math.PI/2,this.scene.add(this.flyLineFocusGroup),this.eventElement=[],this.defaultMaterial=null,this.defaultLightMaterial=null,this.createBottomBg(),this.createChinaBlurLine(),this.createGrid(),this.createRotateBorder(),this.createLabel(),this.createMap(),this.createAnimateVideo(),this.createEvent(),this.createFlyLine(),this.createFlyLineFocus(),this.createParticles(),this.createScatter(),this.createInfoPoint();let e=S.timeline();e.pause(),this.animateTl=e,e.addLabel("focusMap",1.5),e.addLabel("focusMapOpacity",2),e.addLabel("bar",3),e.to(this.camera.instance.position,{duration:2,x:-.2515849818960619,y:12.397744557047988,z:14.647659671139275,ease:"circ.out",onStart:()=>{this.flyLineFocusGroup.visible=!1}}),e.to(this.focusMapGroup.position,{duration:1,x:0,y:0,z:0},"focusMap"),e.to(this.focusMapGroup.scale,{duration:1,x:1,y:1,z:1,ease:"circ.out"},"focusMap"),e.to(this.focusMapTopMaterial,{duration:1,opacity:1,ease:"circ.out"},"focusMapOpacity"),e.to(this.focusMapSideMaterial,{duration:1,opacity:1,ease:"circ.out",onComplete:()=>{this.focusMapSideMaterial.transparent=!1}},"focusMapOpacity"),this.otherLabel.map((t,i)=>{let n=t.element.querySelector(".other-label");e.to(n,{duration:1,delay:.1*i,translateY:0,opacity:1,ease:"circ.out"},"focusMapOpacity")}),e.to(this.mapLineMaterial,{duration:.5,delay:.3,opacity:1},"focusMapOpacity"),e.to(this.rotateBorder1.scale,{delay:.3,duration:1,x:1,y:1,z:1,ease:"circ.out"},"focusMapOpacity"),e.to(this.rotateBorder2.scale,{duration:1,delay:.5,x:1,y:1,z:1,ease:"circ.out",onComplete:()=>{this.flyLineFocusGroup.visible=!0}},"focusMapOpacity"),this.allBar.map((t,i)=>{e.to(t.scale,{duration:1,delay:.1*i,x:1,y:1,z:1,ease:"circ.out"},"bar")}),this.allBarMaterial.map((t,i)=>{e.to(t,{duration:1,delay:.1*i,opacity:1,ease:"circ.out"},"bar")}),this.allProvinceLabel.map((t,i)=>{let n=t.element.querySelector(".provinces-label-wrap"),a=t.element.querySelector(".number .value"),r=Number(a.innerText),l={score:0};e.to(n,{duration:1,delay:.2*i,translateY:0,opacity:1,ease:"circ.out"},"bar"),e.to(l,{duration:1,delay:.2*i,score:r,onUpdate:o},"bar");function o(){a.innerText=l.score.toFixed(0)}}),this.allGuangquan.map((t,i)=>{e.to(t.children[0].scale,{duration:1,delay:.1*i,x:1,y:1,z:1,ease:"circ.out"},"bar"),e.to(t.children[1].scale,{duration:1,delay:.1*i,x:1,y:1,z:1,ease:"circ.out"},"bar")})}initEnvironment(){let e=new te(16777215,3);this.scene.add(e);let t=new ae(16777215,8);t.position.set(-30,6,-8),t.castShadow=!0,t.shadow.radius=20,t.shadow.mapSize.width=1024,t.shadow.mapSize.height=1024,this.scene.add(t),this.createPointLight({color:"#429484",intensity:600,distance:1e4,x:-9,y:3,z:-3}),this.createPointLight({color:"#429484",intensity:230,distance:1e4,x:0,y:2,z:5})}createPointLight(e){const t=new ne(1924702,e.intensity,e.distance);t.position.set(e.x,e.y,e.z),this.scene.add(t)}createMap(){let e=new w,t=new w;this.focusMapGroup=t;let{china:i,chinaTopLine:n}=this.createChina(),{map:a,mapTop:r,mapLine:l}=this.createProvince();i.setParent(e),n.setParent(e),a.setParent(t),r.setParent(t),l.setParent(t),t.position.set(0,0,-.01),t.scale.set(1,1,0),e.add(t),e.rotateX(-Math.PI/2),e.position.set(0,.2,0),this.scene.add(e),this.createBar()}createChina(){let e={chinaBgMaterialColor:"#17211e",lineColor:"#558273"},t=this.assets.instance.getResource("china"),i=new z({color:new G(e.chinaBgMaterialColor),transparent:!0,opacity:1}),n=new U(this,{data:t,geoProjectionCenter:this.geoProjectionCenter,geoProjectionScale:this.geoProjectionScale,merge:!0,material:i,renderOrder:2}),a=new $({color:e.lineColor}),r=new D(this,{data:t,geoProjectionCenter:this.geoProjectionCenter,geoProjectionScale:this.geoProjectionScale,material:a,renderOrder:3});return r.lineGroup.position.z+=.01,{china:n,chinaTopLine:r}}createProvince(){let e=this.assets.instance.getResource("mapJson"),t=this.assets.instance.getResource("test");t.wrapS=t.wrapT=b;let[i,n]=this.createProvinceMaterial();this.focusMapTopMaterial=i,this.focusMapSideMaterial=n;let a=new ye(this,{geoProjectionCenter:this.geoProjectionCenter,geoProjectionScale:this.geoProjectionScale,position:new m(0,0,.11),data:e,depth:this.depth,topFaceMaterial:i,sideMaterial:n,renderOrder:9}),r=new E({color:16777215,transparent:!0,opacity:.5});r.onBeforeCompile=s=>{s.uniforms={...s.uniforms,tDiffuse:{value:t}},s.vertexShader=s.vertexShader.replace("void main() {",`
        attribute float alpha;
        varying vec3 vPosition;
        varying float vAlpha;
        varying vec2 vUv;
        void main() {
          vAlpha = alpha;
          vPosition = position;
          vUv = uv;
      `),s.fragmentShader=s.fragmentShader.replace("void main() {",`
        varying vec3 vPosition;
        varying float vAlpha;
        varying vec2 vUv;
        uniform sampler2D tDiffuse;
        void main() {
      `),s.fragmentShader=s.fragmentShader.replace("#include <opaque_fragment>",`
      #ifdef OPAQUE
      diffuseColor.a = 1.0;
      #endif
            #ifdef USE_TRANSMISSION
      diffuseColor.a *= transmissionAlpha + 0.1;
      #endif
      vec4 col = texture(tDiffuse, vUv.xy);
      float a =(col.r+col.g+col.b) / 3.0; 
    
      gl_FragColor = vec4(outgoingLight,diffuseColor.a * a);
      // gl_FragColor = vec4( outgoingLight, diffuseColor.a  );
      `)},this.defaultMaterial=r,this.defaultLightMaterial=this.defaultMaterial.clone(),this.defaultLightMaterial.emissive.setHex(725293),this.defaultLightMaterial.emissiveIntensity=3.5;let l=new U(this,{geoProjectionCenter:this.geoProjectionCenter,geoProjectionScale:this.geoProjectionScale,position:new m(0,0,this.depth+.22),data:e,material:r,renderOrder:2});l.mapGroup.children.map(s=>{s.children.map(p=>{p.type==="Mesh"&&this.eventElement.push(p)})});let{boxSize:o,box3:c}=ie(l.mapGroup);console.log(l.mapGroup),l.mapGroup.children.map(s=>{s.children.map(p=>{this.calcUv(p.geometry,o.x,o.y,c.min.x,c.min.y)})}),this.mapLineMaterial=new $({color:16777215,opacity:0,transparent:!0,fog:!1});let d=new D(this,{geoProjectionCenter:this.geoProjectionCenter,geoProjectionScale:this.geoProjectionScale,data:e,material:this.mapLineMaterial,renderOrder:3});return d.lineGroup.position.z+=this.depth+.23,{map:a,mapTop:l,mapLine:d}}createProvinceMaterial(){let e=this.assets.instance.getResource("test");e.wrapS=e.wrapT=b;let t=new z({color:16777215,transparent:!0,opacity:0,fog:!1,side:_});t.onBeforeCompile=a=>{a.uniforms={...a.uniforms,uColor1:{value:new G(2781042)},uColor2:{value:new G(860197)}},a.vertexShader=a.vertexShader.replace("void main() {",`
        attribute float alpha;
        varying vec3 vPosition;
        varying float vAlpha;
        varying vec2 vUv;
        void main() {
          vAlpha = alpha;
          vPosition = position;
          vUv = uv;
      `),a.fragmentShader=a.fragmentShader.replace("void main() {",`
        varying vec3 vPosition;
        varying float vAlpha;
        varying vec2 vUv;
        uniform vec3 uColor1;
        uniform vec3 uColor2;
        void main() {
      `),a.fragmentShader=a.fragmentShader.replace("#include <opaque_fragment>",`
      #ifdef OPAQUE
      diffuseColor.a = 1.0;
      #endif
            #ifdef USE_TRANSMISSION
      diffuseColor.a *= transmissionAlpha + 0.1;
      #endif
      vec3 gradient = mix(uColor1, uColor2, vPosition.x/15.78);       
      outgoingLight = outgoingLight*gradient;
      float topAlpha = 0.5;
      if(vPosition.z>0.3){
        diffuseColor.a *= topAlpha;
      }
      gl_FragColor = vec4( outgoingLight, diffuseColor.a  );
      `)};let i=this.assets.instance.getResource("side");i.wrapS=b,i.wrapT=b,i.repeat.set(1,1.5),i.offset.y+=.065;let n=new E({color:10747843,map:i,fog:!1,opacity:0,side:_});return this.time.on("tick",()=>{i.offset.y+=.005}),n.onBeforeCompile=a=>{a.uniforms={...a.uniforms,uColor1:{value:new G(2781042)},uColor2:{value:new G(2781042)}},a.vertexShader=a.vertexShader.replace("void main() {",`
        attribute float alpha;
        varying vec3 vPosition;
        varying float vAlpha;
        void main() {
          vAlpha = alpha;
          vPosition = position;
      `),a.fragmentShader=a.fragmentShader.replace("void main() {",`
        varying vec3 vPosition;
        varying float vAlpha;
        uniform vec3 uColor1;
        uniform vec3 uColor2;
        void main() {
      `),a.fragmentShader=a.fragmentShader.replace("#include <opaque_fragment>",`
      #ifdef OPAQUE
      diffuseColor.a = 1.0;
      #endif
            #ifdef USE_TRANSMISSION
      diffuseColor.a *= transmissionAlpha + 0.1;
      #endif
      vec3 gradient = mix(uColor1, uColor2, vPosition.z/1.2);
      outgoingLight = outgoingLight*gradient;
      gl_FragColor = vec4( outgoingLight, diffuseColor.a  );
      `)},[t,n]}calcUv(e,t,i,n,a){const r=e.attributes.position,l=e.attributes.uv;for(let o=0;o<r.count;o++){const c=r.getX(o),d=r.getY(o),s=(c-n)/t,p=(d-a)/i;l.setXY(o,s,p)}l.needsUpdate=!0,e.computeVertexNormals()}createBar(){let e=this,t=F(X).filter((o,c)=>c<7);const i=new w;this.barGroup=i;const n=.7,a=4*n,r=t[0].value;this.allBar=[],this.allBarMaterial=[],this.allGuangquan=[],this.allProvinceLabel=[],t.map((o,c)=>{let d=a*(o.value/r),s=new x({color:16777215,transparent:!0,opacity:0,depthTest:!1,fog:!1});new be(s,{uColor1:c>3?16506760:5291006,uColor2:c>3?16776948:7863285,size:d,dir:"y"});const p=new se(.1*n,.1*n,d);p.translate(0,0,d/2);const f=new M(p,s);f.renderOrder=5;let u=f,[g,v]=this.geoProjection(o.centroid);u.position.set(g,-v,this.depth+.45),u.scale.set(1,1,0);let y=this.createQuan(new m(g,this.depth+.44,v),c),j=this.createHUIGUANG(d,c>3?16776948:7863285);u.add(...j),i.add(u),i.rotation.x=-Math.PI/2;let H=l(o,c,new m(g,-v,this.depth+1.1+d));this.allBar.push(u),this.allBarMaterial.push(s),this.allGuangquan.push(y),this.allProvinceLabel.push(H)}),this.scene.add(i);function l(o,c,d){let s=e.label3d.create("","provinces-label",!1);return s.init(`<div class="provinces-label ${c>4?"yellow":""}">
      <div class="provinces-label-wrap">
        <div class="number"><span class="value">${o.value}</span><span class="unit">万人</span></div>
        <div class="name">
          <span class="zh">${o.name}</span>
          <span class="en">${o.enName.toUpperCase()}</span>
        </div>
        <div class="no">${c+1}</div>
      </div>
    </div>`,d),e.label3d.setLabelStyle(s,.01,"x"),s.setParent(e.labelGroup),s}}createEvent(){let e=[];const t=n=>{n.traverse(a=>{a.isMesh&&(a.material=this.defaultMaterial)})},i=n=>{n.traverse(a=>{a.isMesh&&(a.material=this.defaultLightMaterial)})};this.eventElement.map(n=>{this.interactionManager.add(n),n.addEventListener("mousedown",a=>{console.log(a.target.userData.name)}),n.addEventListener("mouseover",a=>{e.includes(a.target.parent)||e.push(a.target.parent),document.body.style.cursor="pointer",i(a.target.parent)}),n.addEventListener("mouseout",a=>{e=e.filter(r=>r.userData.name!==a.target.parent.userData.name),e.length>0&&e[e.length-1],t(a.target.parent),document.body.style.cursor="default"})})}createHUIGUANG(e,t){let i=new C(.35,e);i.translate(0,e/2,0);const n=this.assets.instance.getResource("huiguang");n.colorSpace=B,n.wrapS=b,n.wrapT=b;let a=new x({color:t,map:n,transparent:!0,opacity:.4,depthWrite:!1,side:_,blending:P}),r=new M(i,a);r.renderOrder=10,r.rotateX(Math.PI/2);let l=r.clone(),o=r.clone();return l.rotateY(Math.PI/180*60),o.rotateY(Math.PI/180*120),[r,l,o]}createQuan(e,t){const i=this.assets.instance.getResource("guangquan1"),n=this.assets.instance.getResource("guangquan2");let a=new C(.5,.5),r=new x({color:16777215,map:i,alphaMap:i,opacity:1,transparent:!0,depthTest:!1,fog:!1,blending:P}),l=new x({color:16777215,map:n,alphaMap:n,opacity:1,transparent:!0,depthTest:!1,fog:!1,blending:P}),o=new M(a,r),c=new M(a,l);return o.renderOrder=6,c.renderOrder=6,o.rotateX(-Math.PI/2),c.rotateX(-Math.PI/2),o.position.copy(e),c.position.copy(e),c.position.y-=.001,o.scale.set(0,0,0),c.scale.set(0,0,0),this.quanGroup=new w,this.quanGroup.add(o,c),this.scene.add(this.quanGroup),this.time.on("tick",()=>{o.rotation.z+=.05}),this.quanGroup}createGrid(){new xe(this,{gridSize:50,gridDivision:20,gridColor:1923944,shapeSize:.5,shapeColor:3192205,pointSize:.1,pointColor:611133,diffuse:!0,diffuseSpeed:10,diffuseColor:3192205})}createBottomBg(){let e=new C(20,20);const t=this.assets.instance.getResource("ocean");t.colorSpace=B,t.wrapS=b,t.wrapT=b,t.repeat.set(1,1);let i=new x({map:t,opacity:1}),n=new M(e,i);n.rotation.x=-Math.PI/2,n.position.set(0,-.7,0),this.scene.add(n)}createChinaBlurLine(){let e=new C(147,147);const t=this.assets.instance.getResource("chinaBlurLine");t.colorSpace=B,t.wrapS=b,t.wrapT=b,t.generateMipmaps=!1,t.minFilter=oe,t.repeat.set(1,1);let i=new x({color:3969700,alphaMap:t,transparent:!0,opacity:.5}),n=new M(e,i);n.rotateX(-Math.PI/2),n.position.set(-33.2,-.5,-5.2),this.scene.add(n)}createAnimateVideo(){this.createAnimateVideoItem(".map-video1",new m(11,.4,1)),this.createAnimateVideoItem(".map-video2",new m(-11,.4,2))}createAnimateVideoItem(e,t){let i=document.querySelector(e);window.addEventListener("pointerdown",()=>{i.play()});let n=new re(i);n.colorSpace=B;let a=1.2,r=new C(2.5*a,1*a),l=new x({color:10807286,alphaMap:n,transparent:!0,opacity:1,blending:P}),o=new M(r,l);o.rotateX(-Math.PI/2),o.position.copy(t),o.renderOrder=10,this.scene.add(o)}createLabel(){let e=this,t=this.labelGroup,i=this.label3d,n=[];Re.map(s=>{if(s.hide==!0)return!1;let p=o(s,i,t);n.push(p)});let a=c({...this.mapFocusLabelInfo},i,t),r=d({icon:A,center:[118.280637,21.625178],width:"40px",height:"40px",reflect:!0},i,t),l=d({icon:A,center:[106.280637,25.625178],width:"20px",height:"20px",reflect:!1},i,t);n.push(a),n.push(r),n.push(l),this.otherLabel=n;function o(s,p,f){let u=p.create("",`china-label ${s.blur?" blur":""}`,!1);const[g,v]=e.geoProjection(s.center);return u.init(`<div class="other-label"><img class="label-icon" src="${A}">${s.name}</div>`,new m(g,-v,.4)),p.setLabelStyle(u,.02,"x"),u.setParent(f),u}function c(s,p,f){let u=p.create("","map-label",!1);const[g,v]=e.geoProjection(s.center);return u.init(`<div class="other-label"><span>${s.name}</span><span>${s.enName}</span></div>`,new m(g,-v,.4)),p.setLabelStyle(u,.015,"x"),u.setParent(f),u}function d(s,p,f){let u=p.create("",`decoration-label  ${s.reflect?" reflect":""}`,!1);const[g,v]=e.geoProjection(s.center);return u.init(`<div class="other-label"><img class="label-icon" style="width:${s.width};height:${s.height}" src="${s.icon}">`,new m(g,-v,.4)),p.setLabelStyle(u,.02,"x"),u.setParent(f),u}}createRotateBorder(){let e=12,t=this.assets.instance.getResource("rotationBorder1"),i=this.assets.instance.getResource("rotationBorder2"),n=new q(this,{width:e*1.178,needRotate:!0,rotateSpeed:.001,material:new x({map:t,color:2795692,transparent:!0,opacity:.2,side:_,depthWrite:!1,blending:P}),position:new m(0,.28,0)});n.instance.rotation.x=-Math.PI/2,n.instance.renderOrder=6,n.instance.scale.set(0,0,0),n.setParent(this.scene);let a=new q(this,{width:e*1.116,needRotate:!0,rotateSpeed:-.004,material:new x({map:i,color:2795692,transparent:!0,opacity:.4,side:_,depthWrite:!1,blending:P}),position:new m(0,.3,0)});a.instance.rotation.x=-Math.PI/2,a.instance.renderOrder=6,a.instance.scale.set(0,0,0),a.setParent(this.scene),this.rotateBorder1=n.instance,this.rotateBorder2=a.instance}createFlyLine(){this.flyLineGroup=new w,this.flyLineGroup.visible=!1,this.scene.add(this.flyLineGroup);const e=this.assets.instance.getResource("mapFlyline");e.wrapS=e.wrapT=b,e.repeat.set(1,1);const t=.03,i=32,n=8,a=!1;let[r,l]=this.geoProjection(this.flyLineCenter),o=new m(r,-l,0);const c=new x({map:e,alphaMap:e,color:2781042,transparent:!0,fog:!1,opacity:1,depthTest:!1,blending:P});this.time.on("tick",()=>{e.offset.x-=.006}),X.filter((d,s)=>s<7).map(d=>{let[s,p]=this.geoProjection(d.centroid),f=new m(s,-p,0);const u=new m;u.addVectors(o,f).multiplyScalar(.5),u.setZ(3);const g=new le(o,u,f),v=new ce(g,i,t,n,a),y=new M(v,c);y.rotation.x=-Math.PI/2,y.position.set(0,this.depth+.44,0),y.renderOrder=21,this.flyLineGroup.add(y)})}createFlyLineFocus(){let[e,t]=this.geoProjection([113.544372,23.329249]);this.flyLineFocusGroup.position.set(e,this.depth+.442,t);const i=this.assets.instance.getResource("flyLineFocus"),n=new C(1,1),a=new x({color:16777215,map:i,alphaMap:i,transparent:!0,fog:!1,depthTest:!1,blending:P}),r=new M(n,a);r.scale.set(0,0,0);const l=r.clone();l.material=a.clone(),this.flyLineFocusGroup.add(r,l),S.to(r.material,{opacity:0,repeat:-1,yoyo:!1,duration:1}),S.to(r.scale,{x:1.5,y:1.5,z:1.5,repeat:-1,yoyo:!1,duration:1}),S.to(l.material,{delay:.5,opacity:0,repeat:-1,yoyo:!1,duration:1}),S.to(l.scale,{delay:.5,x:1.5,y:1.5,z:1.5,repeat:-1,yoyo:!1,duration:1})}createParticles(){this.particles=new k(this,{num:10,range:30,dir:"up",speed:.05,material:new pe({map:k.createTexture(),size:1,color:61166,transparent:!0,opacity:1,depthTest:!1,depthWrite:!1,vertexColors:!0,blending:P,sizeAttenuation:!0})}),this.particleGroup=new w,this.scene.add(this.particleGroup),this.particleGroup.rotation.x=-Math.PI/2,this.particles.setParent(this.particleGroup),this.particles.enable=!1,this.particleGroup.visible=!1}createScatter(){this.scatterGroup=new w,this.scatterGroup.visible=!1,this.scatterGroup.rotation.x=-Math.PI/2,this.scene.add(this.scatterGroup);const e=this.assets.instance.getResource("arrow"),t=new O({map:e,color:16776948,fog:!1,transparent:!0,depthTest:!1});let i=F(Ue),n=i[0].value;i.map(a=>{const r=new N(t);r.renderOrder=23;let l=.1+a.value/n*.2;r.scale.set(l,l,l);let[o,c]=this.geoProjection([a.lng,a.lat]);r.position.set(o,-c,this.depth+.45),r.userData.position=[o,-c,this.depth+.45],this.scatterGroup.add(r)})}createInfoPoint(){let e=this;this.InfoPointGroup=new w,this.scene.add(this.InfoPointGroup),this.InfoPointGroup.visible=!1,this.InfoPointGroup.rotation.x=-Math.PI/2,this.infoPointIndex=0,this.infoPointLabelTime=null,this.infoLabelElement=[];let t=this.label3d;const i=this.assets.instance.getResource("point");let n=[16776948,7863285],a=F(De),r=a[0].value;a.map((o,c)=>{const d=new O({map:i,color:n[c%n.length],fog:!1,transparent:!0,depthTest:!1}),s=new N(d);s.renderOrder=23;let p=.7+o.value/r*.4;s.scale.set(p,p,p);let[f,u]=this.geoProjection([o.lng,o.lat]),g=[f,-u,this.depth+.7];s.position.set(...g),s.userData.position=[...g],s.userData={position:[f,-u,this.depth+.7],name:o.name,value:o.value,level:o.level,index:c},this.InfoPointGroup.add(s);let v=l(o,t,this.InfoPointGroup);this.infoLabelElement.push(v),this.interactionManager.add(s),s.addEventListener("mousedown",y=>{if(this.clicked||!this.InfoPointGroup.visible)return!1;this.clicked=!0,this.infoPointIndex=y.target.userData.index,this.infoLabelElement.map(j=>{j.visible=!1}),v.visible=!0,this.createInfoPointLabelLoop()}),s.addEventListener("mouseup",y=>{this.clicked=!1}),s.addEventListener("mouseover",y=>{document.body.style.cursor="pointer"}),s.addEventListener("mouseout",y=>{document.body.style.cursor="default"})});function l(o,c,d){let s=c.create("","info-point",!0);const[p,f]=e.geoProjection([o.lng,o.lat]);return s.init(` <div class="info-point-wrap">
          <div class="info-point-wrap-inner">
            <div class="info-point-line">
              <div class="line"></div>
              <div class="line"></div>
              <div class="line"></div>
            </div>
            <div class="info-point-content">
              <div class="content-item"><span class="label">名称</span><span class="value">${o.name}</span></div>
              <div class="content-item"><span class="label">PM2.5</span><span class="value">${o.value}ug/m²</span></div>
              <div class="content-item"><span class="label">等级</span><span class="value">${o.level}</span></div>
            </div>
          </div>
        </div>
      `,new m(p,-f,e.depth+1.9)),c.setLabelStyle(s,.015,"x"),s.setParent(d),s.visible=!1,s}}createInfoPointLabelLoop(){clearInterval(this.infoPointLabelTime),this.infoPointLabelTime=setInterval(()=>{this.infoPointIndex++,this.infoPointIndex>=this.infoLabelElement.length&&(this.infoPointIndex=0),this.infoLabelElement.map((e,t)=>{this.infoPointIndex===t?e.visible=!0:e.visible=!1})},3e3)}geoProjection(e){return we().center(this.geoProjectionCenter).scale(this.geoProjectionScale).translate([0,0])(e)}update(){super.update(),this.interactionManager&&this.interactionManager.update()}destroy(){super.destroy(),this.label3d&&this.label3d.destroy()}}const ke={data(){return this.canvasMap=null,this.initBtnList=[{name:"飞线",checked:!1},{name:"散点图",checked:!1},{name:"重点点位",checked:!1},{name:"粒子特效",checked:!1}],{btnList:R(this.initBtnList)}},mounted(){W.$on("loadMap",this.loadMap)},beforeUnmount(){this.canvasMap.config.hasUpdate=!1,this.canvasMap&&this.canvasMap.destroy()},methods:{loadMap(h){this.canvasMap=new qe(document.getElementById("canvasMap"),h),this.canvasMap.config.hasUpdate=!1},async play(){this.canvasMap.config.hasUpdate=!0,this.canvasMap.animateTl.timeScale(1),this.canvasMap.animateTl.play(),this.showBtn()},showBtn(){S.to(".map-btn-group .btn",{x:0,stagger:.1})},async hideBtn(){this.btnList=R(this.initBtnList),this.initBtnList.map(h=>{this.changeGroupVisible(h.name,h.checked)}),S.to(".map-btn-group .btn",{x:"150%",stagger:.1})},changeBtnChecked(h,e){let t=!this.btnList[e].checked;this.btnList[e].checked=t,this.changeGroupVisible(h,t)},changeGroupVisible(h,e){let t={飞线:"flyLineGroup",散点图:"scatterGroup",重点点位:"InfoPointGroup",粒子特效:"particleGroup"};h==="粒子特效"&&(this.canvasMap.particles.enable=e),h==="飞线"&&(this.canvasMap.flyLineFocusGroup.visible=e),h==="重点点位"&&(this.canvasMap[t[h]].visible=e,e?this.canvasMap.createInfoPointLabelLoop():(clearInterval(this.canvasMap.infoPointLabelTime),this.canvasMap.infoLabelElement.map(i=>{i.visible=!1}))),this.canvasMap&&(this.canvasMap[t[h]].visible=e)}}},Ve={class:"map"},Xe=L("canvas",{id:"canvasMap"},null,-1),Qe=L("video",{class:"map-video map-video1",width:"250",height:"100",loop:"",crossorigin:"anonymous",playsinline:"",style:{display:"none"}},[L("source",{src:Le})],-1),We=L("video",{class:"map-video map-video2",width:"250",height:"100",loop:"",crossorigin:"anonymous",playsinline:"",style:{display:"none"}},[L("source",{src:Me})],-1),Ye={class:"btn-group map-btn-group"},He=["onClick"];function Je(h,e,t,i,n,a){return I(),T("div",Ve,[Xe,Qe,We,L("div",Ye,[(I(!0),T(Fe,null,ze(n.btnList,(r,l)=>(I(),T("div",{class:$e(["btn",{active:r.checked}]),key:l,onClick:o=>a.changeBtnChecked(r.name,l)},Y(r.name),11,He))),128))])])}const Ze=Q(ke,[["render",Je]]),Ke="/globe-map-demos/assets/test-b91a2270.png";class et{constructor(){this.init()}init(){this.instance=new ue,this.instance.addLoader(he,"FileLoader");let e="/globe-map-demos/",t=[{type:"Texture",name:"watermark",path:de},{type:"Texture",name:"flyline",path:fe},{type:"Texture",name:"pathLine",path:me},{type:"Texture",name:"pathLine2",path:ge},{type:"Texture",name:"pathLine3",path:ve},{type:"Texture",name:"test",path:Ke},{type:"File",name:"china",path:e+"assets/json/中华人民共和国.json"},{type:"File",name:"mapJson",path:e+"assets/json/浙江省.json"},{type:"Texture",name:"huiguang",path:Pe},{type:"Texture",name:"rotationBorder1",path:Se},{type:"Texture",name:"rotationBorder2",path:Ge},{type:"Texture",name:"guangquan1",path:V},{type:"Texture",name:"guangquan2",path:Ce},{type:"Texture",name:"chinaBlurLine",path:_e},{type:"Texture",name:"ocean",path:Be},{type:"Texture",name:"side",path:Ie},{type:"Texture",name:"flyLineFocus",path:V},{type:"Texture",name:"mapFlyline",path:Te},{type:"Texture",name:"arrow",path:je},{type:"Texture",name:"point",path:Ae}];this.instance.loadAll(t)}}const tt={components:{mapScene:Ze},data(){return this.assets=null,{progress:0}},mounted(){this.initAssets(async()=>{W.$emit("loadMap",this.assets),await this.hideLoading(),this.$refs.mapScene.play()})},beforeUnmount(){this.assets=null},methods:{initAssets(h){this.assets=new et;let e={progress:0};this.assets.instance.on("onProgress",(t,i,n)=>{let a=Math.floor(i/n)*100;S.to(e,{progress:a,onUpdate:()=>{this.progress=Math.floor(e.progress)}})}),this.assets.instance.on("onLoad",()=>{h&&h()})},async hideLoading(){return new Promise((h,e)=>{let t=S.timeline();t.to(".loading-text span",{y:"200%",opacity:0,ease:"power4.inOut",duration:2,stagger:.2}),t.to(".loading-progress",{opacity:0,ease:"power4.inOut",duration:2},"<"),t.to(".loading",{opacity:0,ease:"power4.inOut",onComplete:()=>{h()}},"-=1")})}}},at={class:"large-screen"},nt={class:"loading"},it=Ne('<div class="loading-text"><span style="--index:1;">L</span><span style="--index:2;">O</span><span style="--index:3;">A</span><span style="--index:4;">D</span><span style="--index:5;">I</span><span style="--index:6;">N</span><span style="--index:7;">G</span></div>',1),st={class:"loading-progress"},ot={class:"value"},rt=L("span",{class:"unit"},"%",-1);function lt(h,e,t,i,n,a){const r=Ee("mapScene");return I(),T("div",at,[Oe(r,{ref:"mapScene"},null,512),L("div",nt,[it,L("div",st,[L("span",ot,Y(this.progress),1),rt])])])}const ht=Q(tt,[["render",lt]]);export{ht as default};
