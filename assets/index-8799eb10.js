import{g as Z,F as K,C as G,i as ee,G as x,h as te,j as S,w as ae,x as ne,y as ie,z as $,L as A,V as m,E,D as _,o as M,M as b,H as se,b as L,P as C,S as B,A as P,N as oe,I as re,Q as le,T as ce,q as pe,m as O,n as N,_ as H,u as R,v as Q,J as he,K as ue,O as de,U as fe,W as me,X as ge,Y as ve}from"./szxs_logo-0ab5ca1e.js";import{B as k,L as q,E as ye,G as D,a as be,l as F,P as V,b as U,g as xe,_ as we,c as Me,h as Le,r as Pe,d as Se,f as W,e as Ge,i as Ce,o as _e,s as Be,m as Ie,j as Te,p as je}from"./flyLine2-932ac3c5.js";import{o as I,c as T,a as w,F as Fe,r as ze,n as $e,t as Y,b as Ae,d as Ee,e as Oe}from"./index-63eb6f16.js";const Ne=[{name:"北京市",center:[116.405285,39.904989],centroid:[116.41995,40.18994],hide:!0},{name:"天津市",center:[117.190182,39.125596],centroid:[117.347043,39.288036],hide:!0},{name:"河北省",center:[114.502461,38.045474],centroid:[114.502461,38.045474],hide:!0},{name:"山西省",center:[112.549248,37.857014],centroid:[112.304436,37.618179],hide:!0},{name:"内蒙古自治区",center:[111.670801,40.818311],centroid:[114.077429,44.331087],hide:!0},{name:"辽宁省",center:[123.429096,41.796767],centroid:[122.604994,41.299712],hide:!0},{name:"吉林省",center:[125.3245,43.886841],centroid:[126.171208,43.703954],hide:!0},{name:"黑龙江省",center:[126.642464,45.756967],centroid:[127.693027,48.040465],hide:!0},{name:"上海市",center:[121.472644,31.231706],centroid:[121.438737,31.072559],hide:!0},{name:"江苏省",center:[118.767413,32.041544],centroid:[119.486506,32.983991],hide:!1},{name:"浙江省",center:[120.153576,30.287459],centroid:[120.109913,29.181466],hide:!0},{name:"安徽省",center:[117.283042,31.86119],centroid:[117.226884,31.849254],hide:!1},{name:"福建省",center:[119.306239,26.075302],centroid:[118.006468,26.069925],hide:!1},{name:"江西省",center:[115.892151,28.676493],centroid:[115.732975,27.636112],hide:!1},{name:"山东省",center:[117.000923,36.675807],centroid:[118.187759,36.376092],blur:!0},{name:"河南省",center:[113.665412,34.757975],centroid:[113.619717,33.902648],blur:!0},{name:"湖北省",center:[114.298572,30.584355],centroid:[112.271301,30.987527],blur:!0},{name:"湖南省",center:[112.982279,28.19409],centroid:[111.711649,27.629216],blur:!0},{name:"广东省",center:[113.280637,23.125178],centroid:[113.429919,23.334643],blur:!0},{name:"广西壮族自治区",center:[108.320004,22.82402],centroid:[108.7944,23.833381],hide:!0},{name:"海南省",center:[110.33119,20.031971],centroid:[109.754859,19.189767],hide:!0},{name:"重庆市",center:[106.504962,29.533155],centroid:[107.8839,30.067297],blur:!0},{name:"四川省",center:[104.065735,30.659462],centroid:[102.693453,30.674545],hide:!0},{name:"贵州省",center:[106.713478,26.578343],centroid:[106.880455,26.826368],blur:!0},{name:"云南省",center:[102.712251,25.040609],centroid:[101.485106,25.008643],hide:!0},{name:"西藏自治区",center:[91.132212,29.660361],centroid:[88.388277,31.56375],hide:!0},{name:"陕西省",center:[108.948024,34.263161],centroid:[108.887114,35.263661],hide:!0},{name:"甘肃省",center:[103.823557,36.058039],centroid:[103.823557,36.058039],hide:!0},{name:"青海省",center:[101.778916,36.623178],centroid:[96.043533,35.726403],hide:!0},{name:"宁夏回族自治区",center:[106.278179,38.46637],centroid:[106.169866,37.291332],hide:!0},{name:"新疆维吾尔自治区",center:[87.617733,43.792818],centroid:[85.294711,41.371801],hide:!0},{name:"台湾省",center:[121.509062,25.044332],centroid:[120.971485,23.749452]},{name:"香港特别行政区",center:[114.173355,22.320048],centroid:[114.134357,22.377366],hide:!0},{name:"澳门特别行政区",center:[113.54909,22.198951],centroid:[113.566988,22.159307],hide:!0}],X=[{name:"杭州市",enName:"hangzhou",value:98,center:[120.153576,30.287459],centroid:[119.476498,29.898918]},{name:"宁波市",enName:"ningbo",value:57,center:[121.549792,29.868388],centroid:[121.479174,29.733017]},{name:"温州市",enName:"wenzhou",value:80,center:[120.672111,28.000575],centroid:[120.463912,27.894726]},{name:"嘉兴市",enName:"jiaxing",value:42,center:[120.750865,30.762653],centroid:[120.783487,30.620063]},{name:"湖州市",enName:"huzhou",value:37,center:[120.102398,30.867198],centroid:[119.873663,30.743058]},{name:"绍兴市",enName:"shaoxing",value:24,center:[120.582112,29.997117],centroid:[120.640933,29.732893]},{name:"金华市",enName:"jinghua",value:43,center:[119.649506,29.089524],centroid:[119.957007,29.115117]},{name:"衢州市",enName:"hengzhou",value:46,center:[118.87263,28.941708],centroid:[118.679569,28.932446]},{name:"舟山市",enName:"zhousan",value:37,center:[122.106863,30.016028],centroid:[122.146805,30.056563]},{name:"台州市",enName:"taizhou",value:36,center:[121.428599,28.661378],centroid:[121.136679,28.757098]},{name:"丽水市",enName:"lishui",value:48,center:[119.921786,28.451993],centroid:[119.517145,28.197644]}],Re=[{value:166,lng:119.00838863314104,lat:29.70446787438727},{value:196,lng:121.95888480416225,lat:29.804570962222094},{value:145,lng:121.1763690119717,lat:29.943827249850777},{value:101,lng:121.56920938135673,lat:29.85263574108389},{value:199,lng:120.9772766279951,lat:28.330342193214033},{value:167,lng:120.33101898043361,lat:30.565600410098323},{value:169,lng:120.36095289685078,lat:30.739761809104824},{value:101,lng:119.983185482632,lat:31.03706617454779},{value:121,lng:121.20282810334723,lat:29.45300711212515},{value:132,lng:120.04632515461387,lat:29.535586166289217},{value:132,lng:119.88396764642604,lat:29.24289373808931},{value:119,lng:118.20295164180662,lat:28.97847155167772},{value:138,lng:119.30239039019484,lat:28.963362607831762},{value:183,lng:122.11925213943688,lat:30.09279983271788},{value:103,lng:122.0641872449813,lat:30.624331727210976},{value:110,lng:121.24428726916929,lat:28.29819603626963},{value:171,lng:120.83475957600818,lat:29.104535097251688},{value:174,lng:119.70182146944745,lat:28.267110085326326}],ke=[{name:"监测点#01",level:"差",value:84.9,lng:118.27595005,lat:29.11596322},{name:"监测点#02",level:"极好",value:12.5,lng:118.94093792,lat:27.90619049},{name:"监测点#03",level:"良好",value:52.8,lng:121.35456753,lat:28.34783376},{name:"监测点#04",level:"好",value:32,lng:122.10985921,lat:30.05331943}];function z(h){return h.sort((e,t)=>t.value-e.value),h}class qe extends Z{constructor(e,t){super(e),this.geoProjectionCenter=[120.109913,29.181466],this.geoProjectionScale=130,this.flyLineCenter=[119.476498,29.898918],this.depth=.5,this.mapFocusLabelInfo={name:"浙江省",enName:"ZHEJIANG PROVINCE",center:[120.109913,26.881466]},this.clicked=!1,this.scene.fog=new K(0,1,50),this.scene.background=new G(0),this.camera.instance.position.set(-13.767695123014105,12.990152163077308,39.28228164159694),this.camera.instance.near=1,this.camera.instance.far=1e4,this.camera.instance.updateProjectionMatrix(),this.interactionManager=new ee(this.renderer.instance,this.camera.instance,this.canvas),this.playing=!1,this.assets=t,this.initEnvironment(),this.init()}init(){this.labelGroup=new x,this.label3d=new te(this),this.labelGroup.rotation.x=-Math.PI/2,this.scene.add(this.labelGroup),this.flyLineFocusGroup=new x,this.flyLineFocusGroup.visible=!1,this.flyLineFocusGroup.rotation.x=-Math.PI/2,this.scene.add(this.flyLineFocusGroup),this.eventElement=[],this.defaultMaterial=null,this.defaultLightMaterial=null,this.createBottomBg(),this.createChinaBlurLine(),this.createGrid(),this.createRotateBorder(),this.createLabel(),this.createMap(),this.createAnimateVideo(),this.createEvent(),this.createFlyLine(),this.createFlyLineFocus(),this.createParticles(),this.createScatter(),this.createInfoPoint();let e=S.timeline();e.pause(),this.animateTl=e,e.addLabel("focusMap",1.5),e.addLabel("focusMapOpacity",2),e.addLabel("bar",3),e.to(this.camera.instance.position,{duration:2,x:-.2515849818960619,y:12.397744557047988,z:14.647659671139275,ease:"circ.out",onStart:()=>{this.flyLineFocusGroup.visible=!1}}),e.to(this.focusMapGroup.position,{duration:1,x:0,y:0,z:0},"focusMap"),e.to(this.focusMapGroup.scale,{duration:1,x:1,y:1,z:1,ease:"circ.out"},"focusMap"),e.to(this.focusMapTopMaterial,{duration:1,opacity:1,ease:"circ.out"},"focusMapOpacity"),e.to(this.focusMapSideMaterial,{duration:1,opacity:1,ease:"circ.out",onComplete:()=>{this.focusMapSideMaterial.transparent=!1}},"focusMapOpacity"),this.otherLabel.map((t,n)=>{let a=t.element.querySelector(".other-label");e.to(a,{duration:1,delay:.1*n,translateY:0,opacity:1,ease:"circ.out"},"focusMapOpacity")}),e.to(this.mapLineMaterial,{duration:.5,delay:.3,opacity:1},"focusMapOpacity"),e.to(this.rotateBorder1.scale,{delay:.3,duration:1,x:1,y:1,z:1,ease:"circ.out"},"focusMapOpacity"),e.to(this.rotateBorder2.scale,{duration:1,delay:.5,x:1,y:1,z:1,ease:"circ.out",onComplete:()=>{this.flyLineFocusGroup.visible=!0}},"focusMapOpacity"),this.allBar.map((t,n)=>{e.to(t.scale,{duration:1,delay:.1*n,x:1,y:1,z:1,ease:"circ.out"},"bar")}),this.allBarMaterial.map((t,n)=>{e.to(t,{duration:1,delay:.1*n,opacity:1,ease:"circ.out"},"bar")}),this.allProvinceLabel.map((t,n)=>{let a=t.element.querySelector(".provinces-label-wrap"),i=t.element.querySelector(".number .value"),o=Number(i.innerText),l={score:0};e.to(a,{duration:1,delay:.2*n,translateY:0,opacity:1,ease:"circ.out"},"bar"),e.to(l,{duration:1,delay:.2*n,score:o,onUpdate:s},"bar");function s(){i.innerText=l.score.toFixed(0)}}),this.allGuangquan.map((t,n)=>{e.to(t.children[0].scale,{duration:1,delay:.1*n,x:1,y:1,z:1,ease:"circ.out"},"bar"),e.to(t.children[1].scale,{duration:1,delay:.1*n,x:1,y:1,z:1,ease:"circ.out"},"bar")})}initEnvironment(){let e=new ae(16777215,3);this.scene.add(e);let t=new ne(16777215,8);t.position.set(-30,6,-8),t.castShadow=!0,t.shadow.radius=20,t.shadow.mapSize.width=1024,t.shadow.mapSize.height=1024,this.scene.add(t),this.createPointLight({color:"#429484",intensity:600,distance:1e4,x:-9,y:3,z:-3}),this.createPointLight({color:"#429484",intensity:230,distance:1e4,x:0,y:2,z:5})}createPointLight(e){const t=new ie(1924702,e.intensity,e.distance);t.position.set(e.x,e.y,e.z),this.scene.add(t)}createMap(){let e=new x,t=new x;this.focusMapGroup=t;let{china:n,chinaTopLine:a}=this.createChina(),{map:i,mapTop:o,mapLine:l}=this.createProvince();n.setParent(e),a.setParent(e),i.setParent(t),o.setParent(t),l.setParent(t),t.position.set(0,0,-.01),t.scale.set(1,1,0),e.add(t),e.rotateX(-Math.PI/2),e.position.set(0,.2,0),this.scene.add(e),this.createBar()}createChina(){let e={chinaBgMaterialColor:"#17211e",lineColor:"#558273"},t=this.assets.instance.getResource("china"),n=new $({color:new G(e.chinaBgMaterialColor),transparent:!0,opacity:1}),a=new k(this,{data:t,geoProjectionCenter:this.geoProjectionCenter,geoProjectionScale:this.geoProjectionScale,merge:!0,material:n,renderOrder:2}),i=new A({color:e.lineColor}),o=new q(this,{data:t,geoProjectionCenter:this.geoProjectionCenter,geoProjectionScale:this.geoProjectionScale,material:i,renderOrder:3});return o.lineGroup.position.z+=.01,{china:a,chinaTopLine:o}}createProvince(){let e=this.assets.instance.getResource("mapJson"),[t,n]=this.createProvinceMaterial();this.focusMapTopMaterial=t,this.focusMapSideMaterial=n;let a=new ye(this,{geoProjectionCenter:this.geoProjectionCenter,geoProjectionScale:this.geoProjectionScale,position:new m(0,0,.11),data:e,depth:this.depth,topFaceMaterial:t,sideMaterial:n,renderOrder:9}),i=new E({color:16777215,transparent:!0,opacity:.5});new D(i),this.defaultMaterial=i,this.defaultLightMaterial=this.defaultMaterial.clone(),this.defaultLightMaterial.emissive.setHex(725293),this.defaultLightMaterial.emissiveIntensity=3.5;let o=new k(this,{geoProjectionCenter:this.geoProjectionCenter,geoProjectionScale:this.geoProjectionScale,position:new m(0,0,this.depth+.22),data:e,material:i,renderOrder:2});o.mapGroup.children.map(s=>{s.children.map(c=>{c.type==="Mesh"&&this.eventElement.push(c)})}),this.mapLineMaterial=new A({color:16777215,opacity:0,transparent:!0,fog:!1});let l=new q(this,{geoProjectionCenter:this.geoProjectionCenter,geoProjectionScale:this.geoProjectionScale,data:e,material:this.mapLineMaterial,renderOrder:3});return l.lineGroup.position.z+=this.depth+.23,{map:a,mapTop:o,mapLine:l}}createProvinceMaterial(){let e=new $({color:16777215,transparent:!0,opacity:0,fog:!1,side:_});e.onBeforeCompile=a=>{a.uniforms={...a.uniforms,uColor1:{value:new G(2781042)},uColor2:{value:new G(860197)}},a.vertexShader=a.vertexShader.replace("void main() {",`
        attribute float alpha;
        varying vec3 vPosition;
        varying float vAlpha;
        void main() {
          vAlpha = alpha;
          vPosition = position;
      `),a.fragmentShader=a.fragmentShader.replace("void main() {",`
        varying vec3 vPosition;
        varying float vAlpha;
        uniform vec3 uColor1;
        uniform vec3 uColor2;
        void main() {
      `),a.fragmentShader=a.fragmentShader.replace("#include <opaque_fragment>",`
      #ifdef OPAQUE
      diffuseColor.a = 1.0;
      #endif
            #ifdef USE_TRANSMISSION
      diffuseColor.a *= transmissionAlpha + 0.1;
      #endif
      vec3 gradient = mix(uColor1, uColor2, vPosition.x/15.78);       outgoingLight = outgoingLight*gradient;
      float topAlpha = 0.5;
      if(vPosition.z>0.3){
        diffuseColor.a *= topAlpha;
      }
      gl_FragColor = vec4( outgoingLight, diffuseColor.a  );
      `)};let t=this.assets.instance.getResource("side");t.wrapS=M,t.wrapT=M,t.repeat.set(1,1.5),t.offset.y+=.065;let n=new E({color:10747843,map:t,fog:!1,opacity:0,side:_});return this.time.on("tick",()=>{t.offset.y+=.005}),n.onBeforeCompile=a=>{a.uniforms={...a.uniforms,uColor1:{value:new G(2781042)},uColor2:{value:new G(2781042)}},a.vertexShader=a.vertexShader.replace("void main() {",`
        attribute float alpha;
        varying vec3 vPosition;
        varying float vAlpha;
        void main() {
          vAlpha = alpha;
          vPosition = position;
      `),a.fragmentShader=a.fragmentShader.replace("void main() {",`
        varying vec3 vPosition;
        varying float vAlpha;
        uniform vec3 uColor1;
        uniform vec3 uColor2;
        void main() {
      `),a.fragmentShader=a.fragmentShader.replace("#include <opaque_fragment>",`
      #ifdef OPAQUE
      diffuseColor.a = 1.0;
      #endif
            #ifdef USE_TRANSMISSION
      diffuseColor.a *= transmissionAlpha + 0.1;
      #endif
      vec3 gradient = mix(uColor1, uColor2, vPosition.z/1.2);
      outgoingLight = outgoingLight*gradient;
      gl_FragColor = vec4( outgoingLight, diffuseColor.a  );
      `)},[e,n]}createBar(){let e=this,t=z(X).filter((s,c)=>c<7);const n=new x;this.barGroup=n;const a=.7,i=4*a,o=t[0].value;this.allBar=[],this.allBarMaterial=[],this.allGuangquan=[],this.allProvinceLabel=[],t.map((s,c)=>{let d=i*(s.value/o),r=new b({color:16777215,transparent:!0,opacity:0,depthTest:!1,fog:!1});new D(r,{uColor1:c>3?16506760:5291006,uColor2:c>3?16776948:7863285,size:d,dir:"y"});const u=new se(.1*a,.1*a,d);u.translate(0,0,d/2);const f=new L(u,r);f.renderOrder=5;let p=f,[g,v]=this.geoProjection(s.centroid);p.position.set(g,-v,this.depth+.45),p.scale.set(1,1,0);let y=this.createQuan(new m(g,this.depth+.44,v),c),j=this.createHUIGUANG(d,c>3?16776948:7863285);p.add(...j),n.add(p),n.rotation.x=-Math.PI/2;let J=l(s,c,new m(g,-v,this.depth+1.1+d));this.allBar.push(p),this.allBarMaterial.push(r),this.allGuangquan.push(y),this.allProvinceLabel.push(J)}),this.scene.add(n);function l(s,c,d){let r=e.label3d.create("","provinces-label",!1);return r.init(`<div class="provinces-label ${c>4?"yellow":""}">
      <div class="provinces-label-wrap">
        <div class="number"><span class="value">${s.value}</span><span class="unit">万人</span></div>
        <div class="name">
          <span class="zh">${s.name}</span>
          <span class="en">${s.enName.toUpperCase()}</span>
        </div>
        <div class="no">${c+1}</div>
      </div>
    </div>`,d),e.label3d.setLabelStyle(r,.01,"x"),r.setParent(e.labelGroup),r}}createEvent(){let e=[];const t=a=>{a.traverse(i=>{i.isMesh&&(i.material=this.defaultMaterial)})},n=a=>{a.traverse(i=>{i.isMesh&&(i.material=this.defaultLightMaterial)})};this.eventElement.map(a=>{this.interactionManager.add(a),a.addEventListener("mousedown",i=>{console.log(i.target.userData.name)}),a.addEventListener("mouseover",i=>{e.includes(i.target.parent)||e.push(i.target.parent),document.body.style.cursor="pointer",n(i.target.parent)}),a.addEventListener("mouseout",i=>{e=e.filter(o=>o.userData.name!==i.target.parent.userData.name),e.length>0&&e[e.length-1],t(i.target.parent),document.body.style.cursor="default"})})}createHUIGUANG(e,t){let n=new C(.35,e);n.translate(0,e/2,0);const a=this.assets.instance.getResource("huiguang");a.colorSpace=B,a.wrapS=M,a.wrapT=M;let i=new b({color:t,map:a,transparent:!0,opacity:.4,depthWrite:!1,side:_,blending:P}),o=new L(n,i);o.renderOrder=10,o.rotateX(Math.PI/2);let l=o.clone(),s=o.clone();return l.rotateY(Math.PI/180*60),s.rotateY(Math.PI/180*120),[o,l,s]}createQuan(e,t){const n=this.assets.instance.getResource("guangquan1"),a=this.assets.instance.getResource("guangquan2");let i=new C(.5,.5),o=new b({color:16777215,map:n,alphaMap:n,opacity:1,transparent:!0,depthTest:!1,fog:!1,blending:P}),l=new b({color:16777215,map:a,alphaMap:a,opacity:1,transparent:!0,depthTest:!1,fog:!1,blending:P}),s=new L(i,o),c=new L(i,l);return s.renderOrder=6,c.renderOrder=6,s.rotateX(-Math.PI/2),c.rotateX(-Math.PI/2),s.position.copy(e),c.position.copy(e),c.position.y-=.001,s.scale.set(0,0,0),c.scale.set(0,0,0),this.quanGroup=new x,this.quanGroup.add(s,c),this.scene.add(this.quanGroup),this.time.on("tick",()=>{s.rotation.z+=.05}),this.quanGroup}createGrid(){new be(this,{gridSize:50,gridDivision:20,gridColor:1923944,shapeSize:.5,shapeColor:3192205,pointSize:.1,pointColor:611133,diffuse:!0,diffuseSpeed:10,diffuseColor:3192205})}createBottomBg(){let e=new C(20,20);const t=this.assets.instance.getResource("ocean");t.colorSpace=B,t.wrapS=M,t.wrapT=M,t.repeat.set(1,1);let n=new b({map:t,opacity:1}),a=new L(e,n);a.rotation.x=-Math.PI/2,a.position.set(0,-.7,0),this.scene.add(a)}createChinaBlurLine(){let e=new C(147,147);const t=this.assets.instance.getResource("chinaBlurLine");t.colorSpace=B,t.wrapS=M,t.wrapT=M,t.generateMipmaps=!1,t.minFilter=oe,t.repeat.set(1,1);let n=new b({color:3969700,alphaMap:t,transparent:!0,opacity:.5}),a=new L(e,n);a.rotateX(-Math.PI/2),a.position.set(-33.2,-.5,-5.2),this.scene.add(a)}createAnimateVideo(){this.createAnimateVideoItem(".map-video1",new m(11,.4,1)),this.createAnimateVideoItem(".map-video2",new m(-11,.4,2))}createAnimateVideoItem(e,t){let n=document.querySelector(e);window.addEventListener("pointerdown",()=>{n.play()});let a=new re(n);a.colorSpace=B;let i=1.2,o=new C(2.5*i,1*i),l=new b({color:10807286,alphaMap:a,transparent:!0,opacity:1,blending:P}),s=new L(o,l);s.rotateX(-Math.PI/2),s.position.copy(t),s.renderOrder=10,this.scene.add(s)}createLabel(){let e=this,t=this.labelGroup,n=this.label3d,a=[];Ne.map(r=>{if(r.hide==!0)return!1;let u=s(r,n,t);a.push(u)});let i=c({...this.mapFocusLabelInfo},n,t),o=d({icon:F,center:[118.280637,21.625178],width:"40px",height:"40px",reflect:!0},n,t),l=d({icon:F,center:[106.280637,25.625178],width:"20px",height:"20px",reflect:!1},n,t);a.push(i),a.push(o),a.push(l),this.otherLabel=a;function s(r,u,f){let p=u.create("",`china-label ${r.blur?" blur":""}`,!1);const[g,v]=e.geoProjection(r.center);return p.init(`<div class="other-label"><img class="label-icon" src="${F}">${r.name}</div>`,new m(g,-v,.4)),u.setLabelStyle(p,.02,"x"),p.setParent(f),p}function c(r,u,f){let p=u.create("","map-label",!1);const[g,v]=e.geoProjection(r.center);return p.init(`<div class="other-label"><span>${r.name}</span><span>${r.enName}</span></div>`,new m(g,-v,.4)),u.setLabelStyle(p,.015,"x"),p.setParent(f),p}function d(r,u,f){let p=u.create("",`decoration-label  ${r.reflect?" reflect":""}`,!1);const[g,v]=e.geoProjection(r.center);return p.init(`<div class="other-label"><img class="label-icon" style="width:${r.width};height:${r.height}" src="${r.icon}">`,new m(g,-v,.4)),u.setLabelStyle(p,.02,"x"),p.setParent(f),p}}createRotateBorder(){let e=12,t=this.assets.instance.getResource("rotationBorder1"),n=this.assets.instance.getResource("rotationBorder2"),a=new V(this,{width:e*1.178,needRotate:!0,rotateSpeed:.001,material:new b({map:t,color:2795692,transparent:!0,opacity:.2,side:_,depthWrite:!1,blending:P}),position:new m(0,.28,0)});a.instance.rotation.x=-Math.PI/2,a.instance.renderOrder=6,a.instance.scale.set(0,0,0),a.setParent(this.scene);let i=new V(this,{width:e*1.116,needRotate:!0,rotateSpeed:-.004,material:new b({map:n,color:2795692,transparent:!0,opacity:.4,side:_,depthWrite:!1,blending:P}),position:new m(0,.3,0)});i.instance.rotation.x=-Math.PI/2,i.instance.renderOrder=6,i.instance.scale.set(0,0,0),i.setParent(this.scene),this.rotateBorder1=a.instance,this.rotateBorder2=i.instance}createFlyLine(){this.flyLineGroup=new x,this.flyLineGroup.visible=!1,this.scene.add(this.flyLineGroup);const e=this.assets.instance.getResource("mapFlyline");e.wrapS=e.wrapT=M,e.repeat.set(1,1);const t=.03,n=32,a=8,i=!1;let[o,l]=this.geoProjection(this.flyLineCenter),s=new m(o,-l,0);const c=new b({map:e,alphaMap:e,color:2781042,transparent:!0,fog:!1,opacity:1,depthTest:!1,blending:P});this.time.on("tick",()=>{e.offset.x-=.006}),X.filter((d,r)=>r<7).map(d=>{let[r,u]=this.geoProjection(d.centroid),f=new m(r,-u,0);const p=new m;p.addVectors(s,f).multiplyScalar(.5),p.setZ(3);const g=new le(s,p,f),v=new ce(g,n,t,a,i),y=new L(v,c);y.rotation.x=-Math.PI/2,y.position.set(0,this.depth+.44,0),y.renderOrder=21,this.flyLineGroup.add(y)})}createFlyLineFocus(){let[e,t]=this.geoProjection([113.544372,23.329249]);this.flyLineFocusGroup.position.set(e,this.depth+.442,t);const n=this.assets.instance.getResource("flyLineFocus"),a=new C(1,1),i=new b({color:16777215,map:n,alphaMap:n,transparent:!0,fog:!1,depthTest:!1,blending:P}),o=new L(a,i);o.scale.set(0,0,0);const l=o.clone();l.material=i.clone(),this.flyLineFocusGroup.add(o,l),S.to(o.material,{opacity:0,repeat:-1,yoyo:!1,duration:1}),S.to(o.scale,{x:1.5,y:1.5,z:1.5,repeat:-1,yoyo:!1,duration:1}),S.to(l.material,{delay:.5,opacity:0,repeat:-1,yoyo:!1,duration:1}),S.to(l.scale,{delay:.5,x:1.5,y:1.5,z:1.5,repeat:-1,yoyo:!1,duration:1})}createParticles(){this.particles=new U(this,{num:10,range:30,dir:"up",speed:.05,material:new pe({map:U.createTexture(),size:1,color:61166,transparent:!0,opacity:1,depthTest:!1,depthWrite:!1,vertexColors:!0,blending:P,sizeAttenuation:!0})}),this.particleGroup=new x,this.scene.add(this.particleGroup),this.particleGroup.rotation.x=-Math.PI/2,this.particles.setParent(this.particleGroup),this.particles.enable=!1,this.particleGroup.visible=!1}createScatter(){this.scatterGroup=new x,this.scatterGroup.visible=!1,this.scatterGroup.rotation.x=-Math.PI/2,this.scene.add(this.scatterGroup);const e=this.assets.instance.getResource("arrow"),t=new O({map:e,color:16776948,fog:!1,transparent:!0,depthTest:!1});let n=z(Re),a=n[0].value;n.map(i=>{const o=new N(t);o.renderOrder=23;let l=.1+i.value/a*.2;o.scale.set(l,l,l);let[s,c]=this.geoProjection([i.lng,i.lat]);o.position.set(s,-c,this.depth+.45),o.userData.position=[s,-c,this.depth+.45],this.scatterGroup.add(o)})}createInfoPoint(){let e=this;this.InfoPointGroup=new x,this.scene.add(this.InfoPointGroup),this.InfoPointGroup.visible=!1,this.InfoPointGroup.rotation.x=-Math.PI/2,this.infoPointIndex=0,this.infoPointLabelTime=null,this.infoLabelElement=[];let t=this.label3d;const n=this.assets.instance.getResource("point");let a=[16776948,7863285],i=z(ke),o=i[0].value;i.map((s,c)=>{const d=new O({map:n,color:a[c%a.length],fog:!1,transparent:!0,depthTest:!1}),r=new N(d);r.renderOrder=23;let u=.7+s.value/o*.4;r.scale.set(u,u,u);let[f,p]=this.geoProjection([s.lng,s.lat]),g=[f,-p,this.depth+.7];r.position.set(...g),r.userData.position=[...g],r.userData={position:[f,-p,this.depth+.7],name:s.name,value:s.value,level:s.level,index:c},this.InfoPointGroup.add(r);let v=l(s,t,this.InfoPointGroup);this.infoLabelElement.push(v),this.interactionManager.add(r),r.addEventListener("mousedown",y=>{if(this.clicked||!this.InfoPointGroup.visible)return!1;this.clicked=!0,this.infoPointIndex=y.target.userData.index,this.infoLabelElement.map(j=>{j.visible=!1}),v.visible=!0,this.createInfoPointLabelLoop()}),r.addEventListener("mouseup",y=>{this.clicked=!1}),r.addEventListener("mouseover",y=>{document.body.style.cursor="pointer"}),r.addEventListener("mouseout",y=>{document.body.style.cursor="default"})});function l(s,c,d){let r=c.create("","info-point",!0);const[u,f]=e.geoProjection([s.lng,s.lat]);return r.init(` <div class="info-point-wrap">
          <div class="info-point-wrap-inner">
            <div class="info-point-line">
              <div class="line"></div>
              <div class="line"></div>
              <div class="line"></div>
            </div>
            <div class="info-point-content">
              <div class="content-item"><span class="label">名称</span><span class="value">${s.name}</span></div>
              <div class="content-item"><span class="label">PM2.5</span><span class="value">${s.value}ug/m²</span></div>
              <div class="content-item"><span class="label">等级</span><span class="value">${s.level}</span></div>
            </div>
          </div>
        </div>
      `,new m(u,-f,e.depth+1.9)),c.setLabelStyle(r,.015,"x"),r.setParent(d),r.visible=!1,r}}createInfoPointLabelLoop(){clearInterval(this.infoPointLabelTime),this.infoPointLabelTime=setInterval(()=>{this.infoPointIndex++,this.infoPointIndex>=this.infoLabelElement.length&&(this.infoPointIndex=0),this.infoLabelElement.map((e,t)=>{this.infoPointIndex===t?e.visible=!0:e.visible=!1})},3e3)}geoProjection(e){return xe().center(this.geoProjectionCenter).scale(this.geoProjectionScale).translate([0,0])(e)}update(){super.update(),this.interactionManager&&this.interactionManager.update()}destroy(){super.destroy(),this.label3d&&this.label3d.destroy()}}const De={data(){return this.canvasMap=null,this.initBtnList=[{name:"飞线",checked:!1},{name:"散点图",checked:!1},{name:"重点点位",checked:!1},{name:"粒子特效",checked:!1}],{btnList:R(this.initBtnList)}},mounted(){Q.$on("loadMap",this.loadMap)},beforeUnmount(){this.canvasMap.config.hasUpdate=!1,this.canvasMap&&this.canvasMap.destroy()},methods:{loadMap(h){this.canvasMap=new qe(document.getElementById("canvasMap"),h),this.canvasMap.config.hasUpdate=!1},async play(){this.canvasMap.config.hasUpdate=!0,this.canvasMap.animateTl.timeScale(1),this.canvasMap.animateTl.play(),this.showBtn()},showBtn(){S.to(".map-btn-group .btn",{x:0,stagger:.1})},async hideBtn(){this.btnList=R(this.initBtnList),this.initBtnList.map(h=>{this.changeGroupVisible(h.name,h.checked)}),S.to(".map-btn-group .btn",{x:"150%",stagger:.1})},changeBtnChecked(h,e){let t=!this.btnList[e].checked;this.btnList[e].checked=t,this.changeGroupVisible(h,t)},changeGroupVisible(h,e){let t={飞线:"flyLineGroup",散点图:"scatterGroup",重点点位:"InfoPointGroup",粒子特效:"particleGroup"};h==="粒子特效"&&(this.canvasMap.particles.enable=e),h==="飞线"&&(this.canvasMap.flyLineFocusGroup.visible=e),h==="重点点位"&&(this.canvasMap[t[h]].visible=e,e?this.canvasMap.createInfoPointLabelLoop():(clearInterval(this.canvasMap.infoPointLabelTime),this.canvasMap.infoLabelElement.map(n=>{n.visible=!1}))),this.canvasMap&&(this.canvasMap[t[h]].visible=e)}}},Ve={class:"map"},Ue=w("canvas",{id:"canvasMap"},null,-1),We=w("video",{class:"map-video map-video1",width:"250",height:"100",loop:"",crossorigin:"anonymous",playsinline:"",style:{display:"none"}},[w("source",{src:we})],-1),Xe=w("video",{class:"map-video map-video2",width:"250",height:"100",loop:"",crossorigin:"anonymous",playsinline:"",style:{display:"none"}},[w("source",{src:Me})],-1),He={class:"btn-group map-btn-group"},Qe=["onClick"];function Ye(h,e,t,n,a,i){return I(),T("div",Ve,[Ue,We,Xe,w("div",He,[(I(!0),T(Fe,null,ze(a.btnList,(o,l)=>(I(),T("div",{class:$e(["btn",{active:o.checked}]),key:l,onClick:s=>i.changeBtnChecked(o.name,l)},Y(o.name),11,Qe))),128))])])}const Je=H(De,[["render",Ye]]);class Ze{constructor(){this.init()}init(){this.instance=new he,this.instance.addLoader(ue,"FileLoader");let e="/globe-map-demos/",t=[{type:"Texture",name:"watermark",path:de},{type:"Texture",name:"flyline",path:fe},{type:"Texture",name:"pathLine",path:me},{type:"Texture",name:"pathLine2",path:ge},{type:"Texture",name:"pathLine3",path:ve},{type:"File",name:"china",path:e+"assets/json/中华人民共和国.json"},{type:"File",name:"mapJson",path:e+"assets/json/浙江省.json"},{type:"Texture",name:"huiguang",path:Le},{type:"Texture",name:"rotationBorder1",path:Pe},{type:"Texture",name:"rotationBorder2",path:Se},{type:"Texture",name:"guangquan1",path:W},{type:"Texture",name:"guangquan2",path:Ge},{type:"Texture",name:"chinaBlurLine",path:Ce},{type:"Texture",name:"ocean",path:_e},{type:"Texture",name:"side",path:Be},{type:"Texture",name:"flyLineFocus",path:W},{type:"Texture",name:"mapFlyline",path:Ie},{type:"Texture",name:"arrow",path:Te},{type:"Texture",name:"point",path:je}];this.instance.loadAll(t)}}const Ke={components:{mapScene:Je},data(){return this.assets=null,{progress:0}},mounted(){this.initAssets(async()=>{Q.$emit("loadMap",this.assets),await this.hideLoading(),this.$refs.mapScene.play()})},beforeUnmount(){this.assets=null},methods:{initAssets(h){this.assets=new Ze;let e={progress:0};this.assets.instance.on("onProgress",(t,n,a)=>{let i=Math.floor(n/a)*100;S.to(e,{progress:i,onUpdate:()=>{this.progress=Math.floor(e.progress)}})}),this.assets.instance.on("onLoad",()=>{h&&h()})},async hideLoading(){return new Promise((h,e)=>{let t=S.timeline();t.to(".loading-text span",{y:"200%",opacity:0,ease:"power4.inOut",duration:2,stagger:.2}),t.to(".loading-progress",{opacity:0,ease:"power4.inOut",duration:2},"<"),t.to(".loading",{opacity:0,ease:"power4.inOut",onComplete:()=>{h()}},"-=1")})}}},et={class:"large-screen"},tt={class:"loading"},at=Oe('<div class="loading-text"><span style="--index:1;">L</span><span style="--index:2;">O</span><span style="--index:3;">A</span><span style="--index:4;">D</span><span style="--index:5;">I</span><span style="--index:6;">N</span><span style="--index:7;">G</span></div>',1),nt={class:"loading-progress"},it={class:"value"},st=w("span",{class:"unit"},"%",-1);function ot(h,e,t,n,a,i){const o=Ae("mapScene");return I(),T("div",et,[Ee(o,{ref:"mapScene"},null,512),w("div",tt,[at,w("div",nt,[w("span",it,Y(this.progress),1),st])])])}const pt=H(Ke,[["render",ot]]);export{pt as default};
