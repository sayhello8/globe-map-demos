import{C as L,G as b,M as f,A as w,l as z,V as g,a as X,T as Y,b as x,d as fe,L as Z,B as R,c as W,e as ue,f as ye,g as ve,R as we,F as be,h as Se,i as xe,j as M,S as G,k as I,m as te,n as ae,t as se,o as T,N as D,P as q,p as Le,D as ne,q as ie,r as oe,s as C,_ as de,u as re,v as me,J as Ge,K as Me,O as Te,U as Ce,W as Ae,X as Oe,Y as _e}from"./szxs_logo-0ab5ca1e.js";import{L as Ie,R as Pe,F as Re,C as ke,s as le,e as Be,a as De,b as Fe,c as ze,h as Ne,g as Ue,l as Ee,d as We,f as je,i as Ve,p as He,j as $e,k as Je,m as qe,n as Qe,o as Xe,q as Ye,r as Ze,t as Ke,u as et}from"./focus_move_bg-793f2183.js";import{o as j,c as V,a as k,F as tt,r as at,n as st,t as ge,b as nt,d as it,e as ot}from"./index-63eb6f16.js";class rt{constructor({material:e,time:t,size:s,diffuseColor:a,diffuseSpeed:n,diffuseHeight:i,diffuseStart:c}){this.time=t;let r={size:100,diffuseSpeed:15,diffuseColor:9345950,diffuseHeight:10,diffuseStart:1};this.options=Object.assign({},r,{material:e,size:s,diffuseColor:a,diffuseSpeed:n,diffuseHeight:i,diffuseStart:c}),this.init()}init(){let e=null,{material:t,size:s,diffuseColor:a,diffuseSpeed:n,diffuseHeight:i,diffuseStart:c}=this.options,r=s/n;t.onBeforeCompile=o=>{e=o,o.uniforms={...o.uniforms,uTime:{value:0},uSpeed:{value:n},uHeight:{value:i},uStart:{value:c},uColor:{value:new L(a)}},o.vertexShader=o.vertexShader.replace("void main() {",`
            varying vec3 vPosition;
            void main(){
              vPosition = position;
          `),o.fragmentShader=o.fragmentShader.replace("void main() {",`
            uniform float uTime;
            uniform vec3 uColor;
            uniform float uSpeed;
            uniform float uHeight;
            uniform float uStart;
            varying vec3 vPosition;
            void main(){
          `),o.fragmentShader=o.fragmentShader.replace("#include <opaque_fragment>",`
            #ifdef OPAQUE
            diffuseColor.a = 1.0;
            #endif
            #ifdef USE_TRANSMISSION
            diffuseColor.a *= material.transmissionAlpha;
            #endif
            float y0 = uStart + uTime * uSpeed * -1.0;
            float h = uHeight / 10.0;
            if(vPosition.y > y0 && vPosition.y < y0 + h*2.0){
              float per = 0.0;
              if(vPosition.y < y0 + h){
                  per = (vPosition.y - y0)*1.0 / h;
                  outgoingLight *= mix(outgoingLight,uColor,per);
                  diffuseColor.a =per;
                  diffuseColor.a =0.0;
              }else{
                  per = (vPosition.y - y0 - h)*1.0 / h;
                  outgoingLight *= mix(uColor,outgoingLight,per);
                  diffuseColor.a = 1.0-per;
              }
          }else{
          }
          gl_FragColor = vec4( outgoingLight, diffuseColor.a );
          `)},this.time.on("tick",o=>{e&&(e.uniforms.uTime.value+=o,e.uniforms.uTime.value>r&&(e.uniforms.uTime.value=0))})}}class E{constructor({time:e},t){this.time=e,this.instance=new b,this.run=!0;let s={speed:.003,texture:null,radius:.1,segments:32,radialSegments:8,data:[],renderOrder:1,globeRadius:106.5,customRunCallback:null,material:new f({color:16777215,transparent:!0,fog:!1,depthTest:!1,depthWrite:!1,blending:w})};this.options=Object.assign({},s,t),this.init()}init(){const{material:e,texture:t,segments:s,radius:a,radialSegments:n,data:i,speed:c,renderOrder:r,globeRadius:o}=this.options;i.map(h=>{let p=[];h.geometry.coordinates.map(v=>{v[0].forEach(N=>{let{x:U,y:H,z:A}=z(...N,o);p.push(new g(U,H,A))})});const u=new X(p),m=new Y(u,s,a,n,!1),y=new x(m,e);y.position.set(0,0,0),y.renderOrder=r,this.instance.curve=u,this.instance.add(y)}),t.offset.x=.5,this.time.on("tick",(h,p)=>{this.run&&(this.options.customRunCallback?this.options.customRunCallback.call(this,h,p,t):t.offset.x+=c*h)})}getInstance(){return this.instance}setParent(e){e.add(this.instance)}set visible(e){this.instance.visible=e,this.run=e}}const lt=(l,e,t)=>{var s=e*Math.PI/180,a=t*Math.PI/180;s=-s;var n=l*Math.cos(a)*Math.cos(s),i=l*Math.sin(a),c=l*Math.cos(a)*Math.sin(s);return{x:n,y:i,z:c}},ce=(l,e,t={})=>{let s={color:65535};s=fe(s,t);const a=new Z(s);let n=e.features,i=ct(n);const c=new R(new Float32Array(i),3),r=new W;r.attributes.position=c;let o=new ue(r,a);return o.scale.set(l,l,l),o.name="createCountryMergeSphereLine",o};function ct(l){let e=[];for(let t=0;t<l.length;t++)l[t].geometry.coordinates.forEach(a=>{const n=[];a[0].forEach(i=>{let{x:c,y:r,z:o}=lt(1,...i);n.push(parseFloat(c.toFixed(3)),parseFloat(r.toFixed(3)),parseFloat(o.toFixed(3)))}),e.push(n[0],n[1],n[2]);for(let i=3;i<n.length;i+=3)e.push(n[i],n[i+1],n[i+2],n[i],n[i+1],n[i+2]);e.push(n[0],n[1],n[2])});return e}function he(l,e){return Math.sqrt((e.x-l.x)*(e.x-l.x)+(e.y-l.y)*(e.y-l.y)+(e.z-l.z)*(e.z-l.z))}const F=[{name:"广州",centroid:[113.544372,23.329249]},{name:"开罗",centroid:[31.2304,30.0372]},{name:"怀特霍斯",centroid:[-115.6722,60.3978]},{name:"珀斯",centroid:[115.8605,-31.9527]},{name:"内罗毕",centroid:[36.8752,-1.2922]},{name:"莫斯科",centroid:[37.5665,55.7571]},{name:"巴西利亚",centroid:[-47.8879,-15.7886]},{name:"华盛顿",centroid:[-77.0365,38.8976]},{name:"东京",centroid:[139.6917,35.6895]},{name:"马尼拉",centroid:[120.9911,15.1202]},{name:"苏瓦",centroid:[178.7253,-17.7838]},{name:"新德里",centroid:[77.1983,28.6354]},{name:"巴黎",centroid:[2.3506,48.8563]},{name:"阿布贾",centroid:[11.8605,32.4401]},{name:"内比都",centroid:[96.1203,19.8554]},{name:"曼谷",centroid:[100.5333,13.7596]},{name:"新加坡",centroid:[103.8167,1.2833]},{name:"德黑兰",centroid:[51.4281,35.6892]},{name:"乌兰巴托",centroid:[106.9173,47.9081]},{name:"斯里兰卡",centroid:[80.6528,6.9261]},{name:"塔那那利佛",centroid:[48.2278,18.3306]}],S=100,P=new g,Q=new g,ht=new g,pe=new ye;class pt extends ve{constructor(e,t){super(e,{isOrthographic:!0}),this.GLOBE_RADIUS=S,this.raycaster=new we,this.assets=t.instance,this.scene.fog=new be(0,0,700),this.camera.instance.position.set(0,0,300),this.camera.instance.near=.01,this.camera.instance.far=1e4,this.camera.instance.lookAt(0,0,0),this.camera.instance.updateProjectionMatrix(),this.camera.controls.enableDamping=!1,this.renderer.instance.setClearColor(0,0),this.focusDataName=F[0].name,this.init(),this.initModel()}init(){this.globeScene=new b,this.scene.add(this.globeScene),this.rippleGroup=new b,this.globeScene.add(this.rippleGroup),this.flyLineGroup=new b,this.globeScene.add(this.flyLineGroup),this.label3d=new Se(this),this.labelGroup=new b,this.label3d.setRenderLevel(3),this.globeScene.add(this.labelGroup),this.dialog2d=new Ie(this),this.dialog2d.setRenderLevel(9),this.dialogGroup=new b,this.globeScene.add(this.dialogGroup),this.landLineGroup=new b,this.globeScene.add(this.landLineGroup),this.coastLineGroup=new b,this.globeScene.add(this.coastLineGroup),this.particleHaloGroup=new b,this.globeScene.add(this.particleHaloGroup),this.interactionManager=new xe(this.renderer.instance,this.camera.instance,this.canvas)}initModel(){this.createGlobe(),this.createGlobeGaoguang(),this.createGlobeLine(),this.createChinaWall(),this.createChinaGlowShadowBg(),this.createChinaGlowBg(),this.createAtmosphere(),this.createCloud(),this.createArcAll(),this.createRippleCirle(),this.createGrid(),this.createStorke(),this.createCoastLine(),this.createLandLine1(),this.createLandLine2(),this.createLabel(),this.createFocus();let e=this.createGlobeRing(S+150);this.createGPS(e.curve),this.createStar(),this.createStar2(),this.initAnimate()}initAnimate(){this.animateIn()}animateIn(){let e=M.timeline();e.to(this.globeScene.rotation,{duration:3,y:3*Math.PI,ease:"power1.inOut"}),e.to(this.globeScene.scale,{duration:2,x:.8,y:.8,z:.8,ease:"power1.inOut"},"-=2")}animateInOut(){return this.globeDom=document.querySelector(".globe"),this.globeDom.tlInOut=M.timeline(),this.globeDom.tlInOut.to(this.globeScene.rotation,{duration:2,y:9*Math.PI,ease:"power1.inOut"}).to(this.globeScene.scale,{duration:2,x:3,y:3,z:3,ease:"power1.inOut",onComplete:()=>{this.globeDom.style.display="none",this.config.hasUpdate=!1,this.star1Tween.pause(),this.star2Tween.pause(),this.globeScene.rotation.y=3*Math.PI}},"<").to(this.globeDom,{opacity:0},"-=1"),this.globeDom.tlInOut}animateOutIn(){this.globeDom.style.display="block",this.config.hasUpdate=!0,this.globeDom.tlOutIn=M.timeline(),this.globeDom.tlOutIn.to(this.globeDom,{opacity:1,duration:.5}).to(this.globeScene.scale,{duration:2,x:.8,y:.8,z:.8,ease:"power4.out"},"<").to(this.globeScene.rotation,{duration:2,y:9*Math.PI,ease:"power4.out",onComplete:()=>{this.globeScene.rotation.y=3*Math.PI,this.star1Tween.play(),this.star2Tween.play()}},"<")}createGlobe(){const e=this.assets.getResource("earthAtoms");e.colorSpace=G;let t=new I(this.GLOBE_RADIUS,60,60),s=new f({color:16777215,map:e,fog:!1}),a=new x(t,s);a.name="earth",this.earthMesh=a,this.globeScene.add(a),this.globeScene.rotation.y=Math.PI,this.globeScene.rotation.x=Math.PI/30,this.globeScene.scale.set(.3,.3,.3),this.globeScene.position.set(0,-5,0),this.setDayNight(s)}setDayNight(e){const t=this.assets.getResource("earthAtoms"),s=this.assets.getResource("earthNight");t.colorSpace=G,s.colorSpace=G,e.onBeforeCompile=a=>{this.shader=a,a.uniforms={...a.uniforms,uColor:{value:new L(16777215)},sunDirection:{value:new g(1,1,0)},dayTexture:{value:t},nightTexture:{value:s}},a.vertexShader=a.vertexShader.replace("void main() {",`
        varying vec2 vUv;
        varying vec3 vNormall;
        void main() {
          vUv = uv;
          vNormall = normalMatrix * normal;
              `),a.fragmentShader=a.fragmentShader.replace("void main() {",`
          uniform sampler2D dayTexture;
          uniform sampler2D nightTexture;
          uniform vec3 sunDirection;
          uniform vec3 uColor;
          varying vec2 vUv;
          varying vec3 vNormall;
          void main() {
        `),a.fragmentShader=a.fragmentShader.replace("#include <opaque_fragment>",`
              #ifdef OPAQUE
              diffuseColor.a = 1.0;
              #endif
              #ifdef USE_TRANSMISSION
              diffuseColor.a *= material.transmissionAlpha;
              #endif
              vec3 dayColor = texture2D(dayTexture, vUv).rgb;
              vec3 nightColor = texture2D(nightTexture, vUv).rgb;
              float cosineAngleSunToNormal = dot(normalize(vNormall), sunDirection);
              cosineAngleSunToNormal = clamp(cosineAngleSunToNormal * 1.0, -1.0, 1.0);
              float mixAmount = cosineAngleSunToNormal * 0.5 + 0.5;
              vec3 color = mix(nightColor, dayColor, mixAmount);
              color *= mix(outgoingLight, uColor, 1.2);
              gl_FragColor = vec4(color , diffuseColor.a );
              `)}}createAtmosphere(){const e=this.assets.getResource("globeHuiguang"),t=S,s=new te({map:e,color:new L("#06FF31"),transparent:!0,fog:!1,depthWrite:!1}),a=new ae(s);let n=t*3.53;a.scale.set(n,n,n),this.globeScene.add(a)}createGlobeGaoguang(){const e=this.assets.getResource("highLight");e.colorSpace=G;let t=new ae(new te({color:3763936,map:e,transparent:!0,fog:!1,alphaMap:e,depthTest:!1,blending:w}));t.position.set(0,0,0),t.scale.set(S*2.5,S*2.5,0),t.renderOrder=2,this.globeScene.add(t)}createGlobeLine(){const e=this.assets.getResource("earthAtomsLine"),t=new I(S*1.001,60,60),s=new f({color:16777215,fog:!1,alphaMap:e,transparent:!0,opacity:1}),a=new x(t,s);this.globeScene.add(a)}createCloud(){const s=this.assets.getResource("earthClouds"),a=new I(S*1.004,60,60),n=new f({color:16777215,map:s,fog:!1,transparent:!0,opacity:.5,depthTest:!1}),i=new x(a,n);this.globeScene.add(i),this.time.on("tick",()=>{i.rotation.y+=-.04*Math.PI/180})}createChinaWall(){let e=new b,t=this.assets.getResource("chinaStorke"),s=se(t);for(let i=0;i<40;i++){let c=ce(100+i*.1,s,{color:90165,transparent:!0,opacity:1});e.add(c)}let a=this.assets.getResource("china");a=se(a);let n=ce(104.2,a,{color:3342243,transparent:!0,opacity:.5,depthWrite:!1,blending:w});n.renderOrder=100,e.add(n),this.globeScene.add(e)}createChinaGlowBg(){let e=this.assets.getResource("chinaGlow");e.colorSpace=G;let t=new I(S+4.25,60,60),s=new f({map:e,transparent:!0,fog:!1,opacity:1,depthWrite:!1}),a=new x(t,s);a.renderOrder=98,this.globeScene.add(a)}createChinaGlowShadowBg(){let e=this.assets.getResource("chinaGlowShadow");e.colorSpace=G;let t=new I(S+.25,60,60),s=new f({map:e,transparent:!0,fog:!1,opacity:1}),a=new x(t,s);this.globeScene.add(a)}createLabel(){F.map(e=>{let t=`<div class="globe-label-content">${e.name}</div>`,s=this.label3d.create(t,"globe-label",!0),{x:a,y:n,z:i}=z(...e.centroid,101);s.init(t,new g(a-10,n,i)),this.label3d.setLabelStyle(s,.22),s.setParent(this.labelGroup)})}createStorke(){const e=this.assets.getResource("pathLine").clone();e.wrapS=e.wrapT=T,e.repeat.set(2,.25);let t=this.assets.getResource("chinaStorke");t=JSON.parse(t);let s=t.features.map(n=>({geometry:n.geometry})),a=new E(this,{data:s,texture:e,renderOrder:99,speed:.15,radius:.2,segments:256*10,radialSegments:4,globeRadius:104.55,material:new f({color:16777215,map:e,fog:!1,transparent:!0,opacity:1,depthWrite:!1,blending:w})});a.run=!0,a.setParent(this.globeScene),this.storkePath=a}createCoastLine(){const e=this.assets.getResource("pathLine3").clone();e.wrapS=e.wrapT=T,e.colorSpace=G,e.repeat.set(70,1),e.generateMipmaps=!1,e.magFilter=D;let t=this.assets.getResource("haianxian");t=JSON.parse(t);let s=t.features.map(n=>({geometry:n.geometry})),a=new E(this,{data:s,texture:e,renderOrder:99,speed:-.6,radius:.2,segments:256*10,radialSegments:4,globeRadius:100.55,material:new f({color:16777215,map:e,fog:!1,transparent:!0,opacity:1,depthWrite:!1,blending:w})});a.run=!0,a.setParent(this.coastLineGroup),this.createMoveIcon(this.coastLineGroup,a.instance.curve)}createLandLine1(){const e=this.assets.getResource("pathLine2").clone();e.wrapS=e.wrapT=T,e.colorSpace=G,e.repeat.set(30,1),e.generateMipmaps=!1,e.magFilter=D;let t=this.assets.getResource("ludixian1");t=JSON.parse(t);let s=t.features.map(n=>({geometry:n.geometry})),a=new E(this,{data:s,texture:e,renderOrder:99,speed:-.6,radius:.2,segments:256*10,radialSegments:4,globeRadius:100.55,material:new f({color:16777215,map:e,fog:!1,transparent:!0,opacity:1,depthWrite:!1,blending:w})});a.run=!0,a.setParent(this.landLineGroup),this.createMoveIcon(this.landLineGroup,a.instance.curve,"luyunIcon","yellow",3e-4)}createLandLine2(){const e=this.assets.getResource("pathLine2").clone();e.wrapS=e.wrapT=T,e.colorSpace=G,e.repeat.set(30,1),e.generateMipmaps=!1,e.magFilter=D;let t=this.assets.getResource("ludixian2");t=JSON.parse(t);let s=t.features.map(n=>({geometry:n.geometry})),a=new E(this,{data:s,texture:e,renderOrder:99,speed:-.6,radius:.2,segments:256*10,radialSegments:4,globeRadius:100.55,material:new f({color:16777215,map:e,fog:!1,transparent:!0,opacity:1,depthWrite:!1,blending:w})});a.run=!0,a.setParent(this.landLineGroup),this.createMoveIcon(this.landLineGroup,a.instance.curve,"luyunIcon",3342243,.001)}createMoveIcon(e,t,s="haiyunIcon",a=3342243,n=1e-4){const i=this.assets.getResource(s).clone();i.wrapS=i.wrapT=T,i.colorSpace=G,i.rotation=-Math.PI/2;const c=new q(1,1),r=new f({color:new L(a),map:i,transparent:!0,opacity:1,depthWrite:!1,depthTest:!1}),o=new x(c,r);o.renderOrder=130,e.add(o),this.addIconEvent(o),o.scale.set(10,10,10);var h=0;this.time.on("tick",()=>{var p=t.getPointAt(h);o.position.copy(p);var u=new g(p.x,p.y,p.z).normalize(),m=new g(0,0,1);o.quaternion.setFromUnitVectors(m,u),o.rotation.z=-Math.PI/2,h+=n,h>.9999&&(h=0)})}addIconEvent(e){this.interactionManager.add(e),e.addEventListener("click",t=>{this.createDialog(t.target)}),e.addEventListener("mouseover",t=>{document.body.style.cursor="pointer"}),e.addEventListener("mouseout",t=>{document.body.style.cursor="default"})}createDialog(e){let t=`
        <div class="globe-dialog">
          <div class="globe-dialog-title">
            <span class="zh">标题内容</span>
            <span class="en">TITLE CONTENT</span>
          </div>
          <div class="globe-dialog-content">
            <div class="online">
              <div class="online-icon"></div>
              <div class="online-content">
                <span class="zh">在线</span>
                <span class="en">ONLINE</span>
              </div>
            </div>
            <div class="event">
              <div class="event-item">
                <div class="label">事件名称</div>
                <div class="value">标题名称内容详情</div>
              </div>
              <div class="event-item">
                <div class="label">发生时间</div>
                <div class="value">2024.02.18</div>
              </div>
              <div class="event-item">
                <div class="label">处理进度</div>
                <div class="value">32%</div>
              </div>
            </div>
          </div>
          <div class="globe-dialog-close">关闭</div>
        </div>
      `,s=this.dialog2d.create(t,"globe-dialog-wrap",!0);s.init(t,e.position),s.setParent(this.dialogGroup),s.element.querySelector(".globe-dialog-close").addEventListener("click",()=>{s.remove()})}createArcAll(){let e=[...F],t=e[0];e.splice(0,1);let s=101,a=25,n=[],i=new b;i.name="arcAll";const c=(d=[],_=s)=>{let J=z(...d,_);return new g(J.x,J.y,J.z)};for(let d=0;d<e.length;d++){var r=c([t.centroid[0],t.centroid[1]],104.26),o=c([e[d].centroid[0],e[d].centroid[1]]),h=1+.005*he(r,o),p=new g;p.addVectors(r,o),p.normalize().multiplyScalar(s*h);var u=1+.005*he(r,p),m=new g;m.addVectors(r,p),m.normalize().multiplyScalar(s*u);var y=new g;y.addVectors(p,o),y.normalize().multiplyScalar(s*u);var v=new Le(r,m,y,o),N=v.getPoints(a);for(let _=0;_<a;_++)n.push(N[_]),n.push(N[_+1])}let U=new W,H=new Z({linewidth:1,color:new L("#ffffff"),blending:w,opacity:1,transparent:!0});var A=new Float32Array(3*n.length),K=new Float32Array(n.length);for(let d=0;d<n.length;d++)A[3*d]=n[d].x,A[3*d+1]=n[d].y,A[3*d+2]=n[d].z,K[d]=1;U.setAttribute("position",new R(A,3));let $=new ue(U,H);i.add($),i.visible=!1,this.flyLineGroup.add(i);let ee=new Z({color:16777215,blending:w,opacity:.5,transparent:!0});ee.onBeforeCompile=d=>{d.uniforms={...d.uniforms,color:{value:new L("#ffffff")}},d.vertexShader=d.vertexShader.replace("void main() {",`
          attribute float alpha;
              varying float vAlpha;
          void main() {
            vAlpha = alpha;
                `),d.fragmentShader=d.fragmentShader.replace("void main() {",`
            uniform vec3 color;
            varying float vAlpha;
            void main() {
          `),d.fragmentShader=d.fragmentShader.replace("#include <opaque_fragment>",`
                #ifdef OPAQUE
                diffuseColor.a = 1.0;
                #endif
                #ifdef USE_TRANSMISSION
                diffuseColor.a *= material.transmissionAlpha;
                #endif
                gl_FragColor = vec4( outgoingLight, diffuseColor.a );
                gl_FragColor = vec4(  color, diffuseColor.a * vAlpha );
                                `)};let B=new b;B.name="Rocket";let O=$.clone();O.geometry=$.geometry.clone(),O.geometry.setAttribute("position",new R(A,3)),O.geometry.setAttribute("alpha",new R(K,1)),O.material=ee,O.renderOrder=100,B.add(O),B.visible=!0,this.arcRocketObject=B,this.flyLineGroup.add(B),this.createFlyLine(e,O,a)}createFlyLine(e,t,s){let a=[],n=t.geometry.attributes.position.array,i=s*2,c=[];for(let h=0;h<n.length;h+=3){let p=n[h],u=n[h+1],m=n[h+2];c.push(new g(p,u,m))}e.map((h,p)=>{let u=c.slice(p*i,i*(p+1));a.push(u)});const r=this.assets.getResource("pathLine").clone();r.wrapS=r.wrapT=T,r.repeat.set(1,1),r.magFilter=D,r.minFilter=D;const o=new f({color:new L("#f60"),map:r,alphaMap:r,transparent:!0,depthWrite:!1,opacity:0,blending:w});this.flyLineMaterial=o,this.flyLineArr=[],a.map(h=>{let p=h,u=new X(p),m={segments:64,radius:.3,radialSegments:8};const y=new Y(u,m.segments,m.radius,m.radialSegments,!1),v=new x(y,o);v.renderOrder=110,this.flyLineArr.push(v),this.flyLineGroup.add(v)}),M.to(this.flyLineMaterial,{opacity:1,ease:"power1.inOut"}),this.time.on("tick",(h,p)=>{o.opacity+=h,o.opacity>1&&(o.opacity=1),r.offset.x-=.4*h})}createGrid(){const e=this.assets.getResource("gridBlack"),t=this.assets.getResource("gridBlack");t.wrapS=t.wrapT=e.wrapS=e.wrapT=T,e.repeat.set(220/2,256/2),t.repeat.set(220/2,256/2);let s=new I(S+20.1,60,60),a=new f({color:7243677,map:e,alphaMap:t,transparent:!0,depthWrite:!1,depthTest:!1,opacity:0,blending:w});new rt({material:a,time:this.time,size:520,diffuseSpeed:150,diffuseColor:16777215,diffuseHeight:820,diffuseStart:110});let n=new x(s,a);setTimeout(()=>{this.globeScene.add(n)},0)}createRippleCirle(){let e=this.rippleGroup;return F.map((s,a)=>({lat:s.centroid[0],lng:s.centroid[1],color:new L(6221735),name:s.name})).forEach((s,a)=>{if(s.name!=this.focusDataName){let c=S+.32,r=new Pe(this,{number:3,radius:Math.random()*3+1,frequency:Math.floor(Math.random()*3)+1,color:s.color});r.instance.userData=s,r.setParent(e),r.instance.traverse(u=>{u.name==="CircleLine"&&(u.renderOrder=110)});let o=z(s.lat,s.lng,c);r.setPosition(new g(o.x,o.y,o.z));var n=new g(o.x,o.y,o.z).normalize(),i=new g(0,0,1);r.instance.quaternion.setFromUnitVectors(i,n);let h=this.createPointLight(s,4),p=this.createLightPillar(4,s.color);r.instance.add(p),r.instance.add(h)}}),e}createPointLight(e,t){const s=this.assets.getResource("pointLight"),a=new q(t,t),n=new f({map:s,transparent:!0,depthWrite:!1,depthTest:!1,color:e.color,blending:w}),i=new x(a,n);return i.scale.set(.5,.5,.5),i.renderOrder=110,i}createLightPillar(e,t){const s=new b,a=this.assets.getResource("lightPillar");let n=41/200,i=e/n;const c=new q(e,i);c.rotateX(Math.PI/2),c.translate(0,0,i/2);const r=new f({map:a,transparent:!0,side:ne,depthWrite:!1,blending:w,color:t}),o=new x(c,r);o.renderOrder=110;const h=o.clone();return h.rotation.z=Math.PI/2,s.add(o,h),s}createFocus(){F.map((e,t)=>{if(e.name===this.focusDataName){let n=new Re(this),{x:i,y:c,z:r}=z(...e.centroid,S+4.26);n.position.set(i,c,r),n.scale.set(15,15,15),this.rippleGroup.add(n),this.focusObj=n;var s=new g(i,c,r).normalize(),a=new g(0,0,1);n.quaternion.setFromUnitVectors(a,s)}})}createGlobeRing(e=100,t=-Math.PI/2){let s=this.assets.getResource("flyline");s.wrapT=s.wrapS=T,s.repeat.set(1,2);let a=new ke(e,100),n=[],i=a.attributes.position.array;for(let u=0;u<i.length;u+=3){let m=i[u],y=i[u+1],v=i[u+2];n.push(new g(m,y,v))}const c=new f({color:new L("#449378"),map:s,side:ne,transparent:!0,depthWrite:!1,opacity:.2});let r=new X(n),o={segments:100,radius:4,radialSegments:2};const h=new Y(r,o.segments,o.radius,o.radialSegments,!1),p=new x(h,c);return p.rotation.x=t,this.particleHaloGroup.add(p),p.curve=r,p}createGPS(e){let t=new b;t.rotation.x=-Math.PI/2;const a=this.assets.getResource("gps").scene.getObjectByName("gps").clone();a.rotation.z=-Math.PI/2,a.scale.set(.8,.8,.8),a.material=new f({color:6221735,wireframe:!0,transparent:!0,opacity:.5}),t.add(a),this.particleHaloGroup.add(t);var n=1;this.time.on("tick",()=>{var i=e.getPointAt(n);a.position.copy(i),n+=5e-4,n>1&&(n=0)})}createStar(){const e=Math.PI*2,t={count:200,size:3,radius:260,thickness:.1,color:"#bef9e5"};let s=new W,a=new Float32Array(t.count*3);const n=this.assets.getResource("dotBlur");for(let r=0;r<t.count;r++){let o=C.randFloat(.9,1)*t.radius,h=Math.pow(C.randFloat(-3,3),3)*o/200,p=Math.pow(C.randFloat(-3,3),3)*o/200,u=Math.pow(C.randFloat(-3,3),3)*o/200,m=r/t.count*e,y=Math.cos(m),v=Math.sin(m);a[r*3]=o*y+h,a[r*3+1]=t.thickness*v+p,a[r*3+2]=o*v+u}let i=new ie({map:n,size:t.size,sizeAttenuation:!0,transparent:!0,depthWrite:!1,blending:w,color:new L(t.color)});s.setAttribute("position",new R(a,3));let c=new oe(s,i);this.star1Tween=M.to(c.rotation,{y:2*Math.PI,repeat:-1,duration:100,ease:"none"}),this.particleHaloGroup.add(c)}createStar2(){const e=Math.PI*2,t={count:300,size:1,radius:260,thickness:.1,color:"#449378"};let s=new W,a=new Float32Array(t.count*3);const n=this.assets.getResource("dotBlur");for(let r=0;r<t.count;r++){let o=C.randFloat(.8,1.2)*t.radius,h=Math.pow(C.randFloat(-3,3),3)*o/100,p=Math.pow(C.randFloat(-3,3),3)*o/100,u=Math.pow(C.randFloat(-3,3),3)*o/100,m=r/t.count*e,y=Math.cos(m),v=Math.sin(m);a[r*3]=o*y+h,a[r*3+1]=t.thickness*v+p,a[r*3+2]=o*v+u}let i=new ie({map:n,size:t.size,sizeAttenuation:!0,transparent:!0,depthWrite:!1,blending:w,color:new L(t.color)});s.setAttribute("position",new R(a,3));let c=new oe(s,i);this.star2Tween=M.to(c.rotation,{y:2*Math.PI,repeat:-1,duration:300,ease:"none"}),this.particleHaloGroup.add(c)}update(){super.update(),this.interactionManager&&this.interactionManager.update(),this.labelGroup&&this.labelGroup.children.length&&this.updateLabel()}updateLabel(){let e=this.camera.instance;pe.getNormalMatrix(e.matrixWorldInverse),e.getWorldPosition(ht),this.labelGroup.children.map(t=>{let s=t.position.clone();if(P.copy(s),P.applyMatrix4(this.globeScene.matrixWorld),P.applyMatrix3(pe),Q.copy(s),Q.applyMatrix4(e.matrixWorldInverse).normalize(),P.dot(Q)>-.22){t.scaleHide();return}t.show(),P.copy(s),P.project(e)})}destroy(){super.destroy(),this.interactionManager&&this.interactionManager.dispose(),this.chinaMap&&this.chinaMap.destroy()}}const ut={data(){return this.canvasGlobe=null,this.initBtnList=[{name:"柱状图",checked:!0},{name:"飞线",checked:!0},{name:"标签",checked:!0},{name:"陆运线",checked:!0},{name:"海航线",checked:!0},{name:"粒子光环",checked:!0}],{btnList:re(this.initBtnList)}},mounted(){me.$on("loadGlobe",this.loadGlobe)},beforeUnmount(){this.canvasGlobe&&this.canvasGlobe.destroy()},methods:{async loadGlobe(l){this.canvasGlobe=new pt(document.getElementById("canvasGlobe"),l),await le(3e3),this.showBtn()},async animateInOut(){this.canvasGlobe&&this.canvasGlobe.animateInOut(),this.hideBtn()},animateOutIn(){this.canvasGlobe&&this.canvasGlobe.animateOutIn(),this.showBtn()},showBtn(){M.to(".globe-btn-group .btn",{x:0,stagger:.1})},async hideBtn(){M.to(".globe-btn-group .btn",{x:"-150%",stagger:.1}),await le(3e3),this.btnList=re(this.initBtnList),this.initBtnList.map(l=>{this.changeGroupVisible(l.name,l.checked)})},changeBtnChecked(l,e){let t=!this.btnList[e].checked;this.btnList[e].checked=t,this.changeGroupVisible(l,t)},changeGroupVisible(l,e){let t={柱状图:"rippleGroup",飞线:"flyLineGroup",标签:"labelGroup",陆运线:"landLineGroup",海航线:"coastLineGroup",粒子光环:"particleHaloGroup"};this.canvasGlobe&&(l==="标签"&&this.canvasGlobe[t[l]].children.map(s=>{s.visible=e}),this.canvasGlobe[t[l]].visible=e)}}},dt={class:"globe"},mt=k("canvas",{id:"canvasGlobe"},null,-1),gt={class:"btn-group globe-btn-group"},ft=["onClick"];function yt(l,e,t,s,a,n){return j(),V("div",dt,[mt,k("div",gt,[(j(!0),V(tt,null,at(a.btnList,(i,c)=>(j(),V("div",{class:st(["btn",{active:i.checked}]),key:c,onClick:r=>n.changeBtnChecked(i.name,c)},ge(i.name),11,ft))),128))])])}const vt=de(ut,[["render",yt]]);class wt{constructor(){this.init()}init(){this.instance=new Ge,this.instance.addLoader(Me,"FileLoader");let e="/globe-map-demos/",t=[{type:"Texture",name:"watermark",path:Te},{type:"Texture",name:"earthAtoms",path:Be},{type:"Texture",name:"earthNight",path:De},{type:"Texture",name:"earthAtomsLine",path:Fe},{type:"Texture",name:"earthClouds",path:ze},{type:"Texture",name:"highLight",path:Ne},{type:"Texture",name:"globeHuiguang",path:Ue},{type:"Texture",name:"lightPillar",path:Ee},{type:"Texture",name:"chinaGlow",path:We},{type:"Texture",name:"chinaGlowShadow",path:je},{type:"Texture",name:"flyline",path:Ce},{type:"Texture",name:"pathLine",path:Ae},{type:"Texture",name:"pathLine2",path:Oe},{type:"Texture",name:"pathLine3",path:_e},{type:"Texture",name:"gridBlack",path:Ve},{type:"Texture",name:"pointLight",path:He},{type:"Texture",name:"dotBlur",path:$e},{type:"Texture",name:"haiyunIcon",path:Je},{type:"Texture",name:"luyunIcon",path:qe},{type:"GLTF",name:"gps",path:Qe},{type:"File",name:"chinaStorke",path:e+"assets/json/中华人民共和国-轮廓-地球.json"},{type:"File",name:"china",path:e+"assets/json/中华人民共和国.json"},{type:"File",name:"haianxian",path:e+"assets/json/海岸线.json"},{type:"File",name:"ludixian1",path:e+"assets/json/陆地线1.json"},{type:"File",name:"ludixian2",path:e+"assets/json/陆地线2.json"},{type:"File",name:"mapJson",path:e+"assets/json/广东省.json"},{type:"Texture",name:"focusArrows",path:Xe},{type:"Texture",name:"focusBar",path:Ye},{type:"Texture",name:"focusBg",path:Ze},{type:"Texture",name:"focusMidQuan",path:Ke},{type:"Texture",name:"focusMoveBg",path:et}];this.instance.loadAll(t)}}const bt={components:{globeScene:vt},data(){return this.clouds=null,this.assets=null,{sceneName:"globe",disabedClick:!1,progress:0}},mounted(){this.initAssets(async()=>{me.$emit("loadGlobe",this.assets),this.hideLoading()})},beforeUnmount(){this.assets=null},methods:{initAssets(l){this.assets=new wt;let e={progress:0};this.assets.instance.on("onProgress",(t,s,a)=>{let n=Math.floor(s/a)*100;M.to(e,{progress:n,onUpdate:()=>{this.progress=Math.floor(e.progress)}})}),this.assets.instance.on("onLoad",()=>{l&&l()})},hideLoading(){let l=M.timeline();l.to(".loading-text span",{y:"200%",opacity:0,ease:"power4.inOut",duration:2,stagger:.2}),l.to(".loading-progress",{opacity:0,ease:"power4.inOut",duration:2},"<"),l.to(".loading",{opacity:0,ease:"power4.inOut"},"-=1")}}},St={class:"large-screen"},xt={class:"loading"},Lt=ot('<div class="loading-text"><span style="--index:1;">L</span><span style="--index:2;">O</span><span style="--index:3;">A</span><span style="--index:4;">D</span><span style="--index:5;">I</span><span style="--index:6;">N</span><span style="--index:7;">G</span></div>',1),Gt={class:"loading-progress"},Mt={class:"value"},Tt=k("span",{class:"unit"},"%",-1);function Ct(l,e,t,s,a,n){const i=nt("globeScene");return j(),V("div",St,[it(i,{ref:"globeScene"},null,512),k("div",xt,[Lt,k("div",Gt,[k("span",Mt,ge(this.progress),1),Tt])])])}const It=de(bt,[["render",Ct]]);export{It as default};
